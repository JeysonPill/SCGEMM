<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Academic Management System</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
    integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.datatables.net/2.2.2/css/dataTables.dataTables.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
    integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">


  <style>
    body {
      font-family: "Segoe UI", Roboto, Arial, sans-serif;
      padding: 20px;
      max-width: 1200px;
      margin: 0 auto;
      background-color: #f5f7fa;
      color: #333;
    }

    .nav-tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      border-bottom: 2px solid #e0e0e0;
      padding-bottom: 10px;
    }

    .nav-tab {
      padding: 10px 18px;
      cursor: pointer;
      background: #fff;
      border: 1px solid #ccc;
      border-radius: 6px 6px 0 0;
      transition: background 0.2s, color 0.2s, border-color 0.2s;
    }

    .nav-tab:hover {
      background-color: #e9ecef;
    }

    .nav-tab.active {
      background: #0d6efd;
      color: #fff;
      border-color: #0d6efd #0d6efd #fff;
    }


    .content-section,
    .tab-content {
      display: none;
      background: #fff;
      padding: 20px;
      border: 1px solid #ddd;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
      margin-top: 20px;
    }

    .tab-content.active,
    .content-section.active {
      display: block;
    }


    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      background: #fff;
      border-radius: 6px;
      overflow: hidden;
    }

    th,
    td {
      padding: 14px;
      border: 1px solid #eee;
      text-align: left;
    }

    th {
      background-color: #f1f3f5;
      font-weight: 600;
    }


    .logout-button,
    .action-button {
      padding: 10px 18px;
      border: none;
      border-radius: 6px;
      color: #fff;
      cursor: pointer;
      font-weight: 500;
      transition: background 0.2s;
    }

    .logout-button {
      background-color: #dc3545;
      float: right;
    }

    .logout-button:hover {
      background-color: #bb2d3b;
    }

    .action-button {
      background-color: #0d6efd;
      margin: 5px;
    }

    .action-button:hover {
      background-color: #0b5ed7;
    }


    .form-group {
      margin-bottom: 16px;
    }

    .form-group label {
      display: block;
      margin-bottom: 6px;
      font-weight: 500;
    }

    .form-group input {
      width: 100%;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
      transition: border-color 0.2s;
    }

    .form-group input:focus {
      border-color: #0d6efd;
      outline: none;
    }


    .form-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(33, 37, 41, 0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 999;
    }

    .form-container {
      background: #fff;
      padding: 24px;
      border-radius: 8px;
      max-width: 480px;
      width: 100%;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .qr-section {
      text-align: center;
      margin: 24px 0;
    }

    #qr-display {
      position: fixed;
      bottom: 10%;
      left: 50%;
      transform: translateX(-50%);
      z-index: 1000;
      width: 30%;
      height: 30%;
    }
  </style>
</head>

<body>


  <div id="login-content" class="content-section d-flex justify-content-center align-items-center vh-100">
    <div class="card p-4 shadow-sm login-card">
      <h2 class="card-title text-center mb-4">Login</h2>
      <form id="login-form">
        <div class="form-group">
          <label for="username">Usuario</label>
          <input type="text" id="username" class="form-control" required>
        </div>
        <div class="form-group">
          <label for="password">Contraseña</label>
          <input type="password" id="password" class="form-control" required>
        </div>
        <button type="submit" class="btn btn-primary btn-block action-button mt-4">Login</button>
      </form>
      <div id="error-message" class="text-danger mt-3 text-center"></div>
    </div>
  </div>


  <div id="student-content" class="content-section container-fluid" style="display: none;">
    <nav class="navbar navbar-expand-lg navbar-light bg-light shadow-sm mb-4">
      <a class="navbar-brand" href="#">Panel de Estudiantes</a>
      <div class="ml-auto">
        <button class="btn btn-outline-danger logout-button" onclick="handleLogout()">Cerrar sesión</button>
      </div>
    </nav>

    <div class="row">
      <div class="col-md-3 col-lg-2">
        <div class="nav flex-column nav-pills custom-nav-pills" id="v-pills-tab" role="tablist"
          aria-orientation="vertical">
          <a class="nav-link active" id="v-pills-subjects-tab" data-toggle="pill" href="#enrolled-subjects" role="tab"
            aria-controls="enrolled-subjects" aria-selected="true"
            onclick="switchTab('enrolled-subjects', this)">Materias</a>
          <a class="nav-link" id="v-pills-grades-tab" data-toggle="pill" href="#grades" role="tab"
            aria-controls="grades" aria-selected="false" onclick="switchTab('grades', this)">Calificaciones</a>
          <a class="nav-link" id="v-pills-kardex-tab" data-toggle="pill" href="#kardex" role="tab"
            aria-controls="kardex" aria-selected="false" onclick="switchTab('kardex', this)">Kardex</a>
          <a class="nav-link" id="v-pills-payments-tab" data-toggle="pill" href="#payments" role="tab"
            aria-controls="payments" aria-selected="false" onclick="switchTab('payments', this)">Pagos</a>
          <a class="nav-link" id="v-pills-attendance-tab" data-toggle="pill" href="#attendance" role="tab"
            aria-controls="attendance" aria-selected="false" onclick="switchTab('attendance', this)">Asistencias</a>
        </div>
      </div>
      <div class="col-md-9 col-lg-10">
        <div class="tab-content" id="v-pills-tabContent">
          <div class="tab-pane fade show active" id="enrolled-subjects" role="tabpanel"
            aria-labelledby="v-pills-subjects-tab">
            <h3 class="mb-3">Materias</h3>
            <div class="table-responsive">
              <table class="table table-hover table-striped">
                <thead class="thead-dark">
                  <tr>
                    <th>Nombre</th>
                    <th>Profesor</th>
                    <th>Horarios</th>
                    <th>Grupos</th>
                  </tr>
                </thead>
                <tbody id="subjects-table">
                </tbody>
              </table>
            </div>
          </div>

          <div class="tab-pane fade" id="grades" role="tabpanel" aria-labelledby="v-pills-grades-tab">
            <h3 class="mb-3">Calificaciones</h3>
            <div class="table-responsive">
              <table class="table table-hover table-striped">
                <thead class="thead-dark">
                  <tr>
                    <th>Nombre</th>
                    <th>Parcial 1</th>
                    <th>Parcial 2</th>
                    <th>Final</th>
                    <th>Promedio</th>
                  </tr>
                </thead>
                <tbody id="grades-table">
                </tbody>
              </table>
            </div>
          </div>

          <div class="tab-pane fade" id="kardex" role="tabpanel" aria-labelledby="v-pills-kardex-tab">
            <h3 class="mb-3">Historial académico</h3>
            <div class="table-responsive">
              <table class="table table-hover table-striped">
                <thead class="thead-dark">
                  <tr>
                    <th>Materia</th>
                    <th>Periodo</th>
                    <th>Calificación final</th>
                    <th>Estado</th>
                  </tr>
                </thead>
                <tbody id="kardex-table">
                </tbody>
              </table>
            </div>
          </div>

          <div class="tab-pane fade" id="payments" role="tabpanel" aria-labelledby="v-pills-payments-tab">
            <h3 class="mb-3">Estado de pagos</h3>
            <div class="table-responsive">
              <table class="table table-hover table-striped">
                <thead class="thead-dark">
                  <tr>
                    <th>Mes</th>
                    <th>Cantidad</th>
                    <th>Fecha de corte</th>
                    <th>Estado</th>
                    <th>Acción</th>
                  </tr>
                </thead>
                <tbody id="payments-table">
                </tbody>
              </table>
            </div>
          </div>

          <div class="tab-pane fade" id="attendance" role="tabpanel" aria-labelledby="v-pills-attendance-tab">
            <h3 class="mb-3">Registro de asistencia</h3>
            <div class="qr-section card p-4 shadow-sm">
              <div id="qr-reader" class="mb-3 text-center"></div>
              <p class="text-center">Ingresa código de asistencia:</p>
              <div class="form-group">
                <input type="text" id="attendance-code" class="form-control" placeholder="Ingresa código">
              </div>
              <button onclick="submitAttendance()" class="btn btn-primary action-button btn-block mt-3">Enviar</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="student-panel" class="content-section" style="display:none;">
    <h2>Gestión de Estudiantes</h2>
    <button class="btn btn-primary mb-3" onclick="showStudentForm('create')">Crear Nuevo Estudiante</button>

    <div id="student-form-section" class="card p-4 shadow-sm mb-4" style="display:none;">
      <h3><span id="student-form-title"></span> Estudiante</h3>
      <form id="student-form">
        <input type="hidden" id="student-matricula-edit">
        <div class="form-group">
          <label for="matricula">Matrícula:</label>
          <input type="text" class="form-control" id="matricula" required>
        </div>
        <div class="form-group">
          <label for="nombre">Nombre:</label>
          <input type="text" class="form-control" id="student-nombre" required>
        </div>
        <div class="form-group">
          <label for="carrera">Carrera:</label>
          <input type="text" class="form-control" id="carrera" required>
        </div>
        <div class="form-group">
          <label for="semestre">Semestre:</label>
          <input type="text" class="form-control" id="semestre" required>
        </div>
        <div class="form-group">
          <label for="user_name">Usuario:</label>
          <input type="text" class="form-control" id="student-user_name" required>
        </div>
        <div class="form-group">
          <label for="celular">Celular:</label>
          <input type="text" class="form-control" id="student-celular" required>
        </div>
        <div class="form-group">
          <label for="email">Email:</label>
          <input type="email" class="form-control" id="student-email" required>
        </div>
        <button type="submit" class="btn btn-success">Guardar Estudiante</button>
        <button type="button" class="btn btn-secondary" onclick="hideStudentForm()">Cancelar</button>
      </form>
    </div>

    <table id="students-table" class="table table-striped table-bordered" style="width:100%">
      <thead>
        <tr>
          <th>Matrícula</th>
          <th>Nombre</th>
          <th>Carrera</th>
          <th>Semestre</th>
          <th>Usuario</th>
          <th>Celular</th>
          <th>Email</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody id="students-table-body">
        <!-- Dynamic content will be inserted here -->
      </tbody>
    </table>
  </div>

  <div id="subject-panel" class="content-section" style="display:none;">
    <h2>Gestión de Materias</h2>
    <button class="btn btn-primary mb-3" onclick="showSubjectForm('create')">Crear Nueva Materia</button>

    <div id="subject-form-section" class="card p-4 shadow-sm mb-4" style="display:none;">
      <h3><span id="subject-form-title"></span> Materia</h3>
      <form id="subject-form">
        <input type="hidden" id="subject-id-edit">
        <div class="form-group">
          <label for="id_materia">ID Materia:</label>
          <input type="text" class="form-control" id="id_materia" required>
        </div>
        <div class="form-group">
          <label for="materia_nombre">Nombre Materia:</label>
          <input type="text" class="form-control" id="materia_nombre" required>
        </div>
        <div class="form-group">
          <label for="sem_cursante">Semestre Cursante:</label>
          <input type="text" class="form-control" id="sem_cursante" required>
        </div>
        <button type="submit" class="btn btn-success">Guardar Materia</button>
        <button type="button" class="btn btn-secondary" onclick="hideSubjectForm()">Cancelar</button>
      </form>
    </div>

    <table id="subjects-table" class="table table-striped table-bordered" style="width:100%">
      <thead>
        <tr>
          <th>ID Materia</th>
          <th>Nombre Materia</th>
          <th>Semestre Cursante</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
      </tbody>
    </table>
  </div>

  <div id="grade-panel" class="content-section" style="display:none;">
    <h2>Gestión de Calificaciones</h2>
    <button class="btn btn-primary mb-3" onclick="showGradeForm('create')">Crear Nueva Calificación</button>

    <div id="grade-form-section" class="card p-4 shadow-sm mb-4" style="display:none;">
      <h3><span id="grade-form-title"></span> Calificación</h3>
      <form id="grade-form">
        <input type="hidden" id="grade-id_materia-edit">
        <input type="hidden" id="grade-matricula-edit">
        <div class="form-group">
          <label for="grade_id_materia">ID Materia:</label>
          <input type="text" class="form-control" id="grade_id_materia" required>
        </div>
        <div class="form-group">
          <label for="grade_matricula">Matrícula Alumno:</label>
          <input type="text" class="form-control" id="grade_matricula" required>
        </div>
        <div class="form-group">
          <label for="calif_p1">Calificación P1:</label>
          <input type="text" class="form-control" id="calif_p1">
        </div>
        <div class="form-group">
          <label for="calif_p2">Calificación P2:</label>
          <input type="text" class="form-control" id="calif_p2">
        </div>
        <div class="form-group">
          <label for="calif_final">Calificación Final:</label>
          <input type="text" class="form-control" id="calif_final">
        </div>
        <div class="form-group">
          <label for="ciclo_cursando">Ciclo Cursando:</label>
          <input type="text" class="form-control" id="ciclo_cursando" required>
        </div>
        <button type="submit" class="btn btn-success">Guardar Calificación</button>
        <button type="button" class="btn btn-secondary" onclick="hideGradeForm()">Cancelar</button>
      </form>
    </div>

    <table id="grades-table" class="table table-striped table-bordered" style="width:100%">
      <thead>
        <tr>
          <th>ID Materia</th>
          <th>Matrícula</th>
          <th>Calificación P1</th>
          <th>Calificación P2</th>
          <th>Calificación Final</th>
          <th>Ciclo Cursando</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
      </tbody>
    </table>
  </div>


  <div id="professor-content" class="content-section container-fluid">
    <nav class="navbar navbar-expand-lg navbar-light bg-light shadow-sm mb-4">
      <a class="navbar-brand" href="#">Panel de Profesor</a>
      <div class="ml-auto">
        <button class="btn btn-outline-danger logout-button" onclick="handleLogout()">Cerrar sesión</button>
      </div>
    </nav>

    <div class="row">
      <div class="col-md-3 col-lg-2">
        <div class="nav flex-column nav-pills custom-nav-pills" id="v-pills-tab-prof" role="tablist"
          aria-orientation="vertical">
          <a class="nav-link active" id="v-pills-schedule-tab" data-toggle="pill" href="#teaching-schedule" role="tab"
            aria-controls="teaching-schedule" aria-selected="true"
            onclick="switchTab('teaching-schedule', this)">Horario de clases</a>
          <a class="nav-link" id="v-pills-qr-tab" data-toggle="pill" href="#attendance-qr" role="tab"
            aria-controls="attendance-qr" aria-selected="false" onclick="switchTab('attendance-qr', this)">QR de
            asistencia</a>
          <a class="nav-link" id="v-pills-grade-entry-tab" data-toggle="pill" href="#profesor_grade_entry" role="tab"
            aria-controls="profesor_grade_entry" aria-selected="false"
            onclick="switchTab('profesor_grade_entry', this)">Ingreso de Calificaciones</a>
        </div>
      </div>
      <div class="col-md-9 col-lg-10">
        <div class="tab-content" id="v-pills-tabContent-prof">
          <div class="tab-pane fade show active" id="teaching-schedule" role="tabpanel"
            aria-labelledby="v-pills-schedule-tab">
            <h3 class="mb-3">Horario de clases</h3>
            <div class="table-responsive">
              <table class="table table-hover table-striped">
                <thead class="thead-dark">
                  <tr>
                    <th>Materia</th>
                    <th>Grupo</th>
                    <th>Horario</th>
                  </tr>
                </thead>
                <tbody id="schedule-table">
                </tbody>
              </table>
            </div>
          </div>

          <div class="tab-pane fade" id="attendance-qr" role="tabpanel" aria-labelledby="v-pills-qr-tab">
            <h3 class="mb-3">Generar QR de asistencia</h3>
            <div class="card p-4 shadow-sm">
              <div class="form-group">
                <label for="qr_subject_select">Elegir materia</label>
                <select id="qr_subject_select" class="form-control">
                  <option value="">Seleccione una materia</option>
                </select>
              </div>
              <button onclick="QR_CODE_GEN()" class="btn btn-primary action-button mt-3">Generar QR</button>
              <div id="qr-display" class="mt-4 text-center"></div>
            </div>
          </div>

          <div class="tab-pane fade" id="profesor_grade_entry" role="tabpanel"
            aria-labelledby="v-pills-grade-entry-tab">
            <h3 class="mb-3">Ingreso de calificaciones</h3>
            <div class="form-group">
              <label for="professor_grade_subject_select">Elija materia</label>
              <select id="professor_grade_subject_select" class="form-control"></select>
            </div>
            <div class="table-responsive mt-4">
              <table class="table table-hover table-striped">
                <thead class="thead-dark">
                  <tr>
                    <th>Estudiante</th>
                    <th>Parcial 1</th>
                    <th>Parcial 2</th>
                    <th>Final</th>
                    <th>Acción</th>
                  </tr>
                </thead>
                <tbody id="profesor_grade_entry_table">
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div id="professor-panel" class="content-section" style="display:none;">
    <h2>Gestión de Profesores</h2>
    <button class="btn btn-primary mb-3" onclick="showProfessorForm('create')">Crear Nuevo Profesor</button>

    <div id="professor-form-section" class="card p-4 shadow-sm mb-4" style="display:none;">
      <h3><span id="professor-form-title"></span> Profesor</h3>
      <form id="professor-form">
        <input type="hidden" id="professor-id-edit">
        <div class="form-group">
          <label for="id_profesor">ID Profesor:</label>
          <input type="text" class="form-control" id="id_profesor" required>
        </div>
        <div class="form-group">
          <label for="profesor_nombre">Nombre:</label>
          <input type="text" class="form-control" id="profesor_nombre" required>
        </div>
        <div class="form-group">
          <label for="profesor_celular">Celular:</label>
          <input type="text" class="form-control" id="profesor_celular" required>
        </div>
        <div class="form-group">
          <label for="profesor_email">Email:</label>
          <input type="email" class="form-control" id="profesor_email" required>
        </div>
        <div class="form-group">
          <label for="profesor_fecha_ingreso">Fecha de Ingreso:</label>
          <input type="date" class="form-control" id="profesor_fecha_ingreso" required>
        </div>
        <button type="submit" class="btn btn-success">Guardar Profesor</button>
        <button type="button" class="btn btn-secondary" onclick="hideProfessorForm()">Cancelar</button>
      </form>
    </div>

    <table id="professors-table" class="table table-striped table-bordered" style="width:100%">
      <thead>
        <tr>
          <th>ID Profesor</th>
          <th>Nombre</th>
          <th>Celular</th>
          <th>Email</th>
          <th>Fecha de Ingreso</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
      </tbody>
    </table>
  </div>

  <div id="admin-staff-content" class="content-section container-fluid " style="display: none;">
    <nav class="navbar navbar-expand-lg navbar-light bg-light shadow-sm mb-4">
      <a class="navbar-brand" href="#">Panel de Administrativos</a>
      <div class="ml-auto">
        <button class="btn btn-outline-danger logout-button" onclick="handleLogout()">Cerrar sesión</button>
      </div>
    </nav>
    <div class="row">
      <div class="col-md-3 col-lg-2">
        <div class="nav flex-column nav-pills custom-nav-pills" id="v-pills-tab-admin" role="tablist"
          aria-orientation="vertical">
          <a class="nav-link active" id="v-pills-student-mgmt-tab" data-toggle="pill" href="#student-management"
            role="tab" aria-controls="student-management" aria-selected="true"
            onclick="switchTab('student-management', this)">Estudiantes</a>
          <a class="nav-link" id="v-pills-professor-mgmt-tab" data-toggle="pill" href="#professor-management" role="tab"
            aria-controls="professor-management" aria-selected="false"
            onclick="switchTab('professor-management', this)">Profesores</a>
          <a class="nav-link" id="v-pills-subject-mgmt-tab" data-toggle="pill" href="#subject-management" role="tab"
            aria-controls="subject-management" aria-selected="false"
            onclick="switchTab('subject-management', this)">Materias</a>
          <a class="nav-link" id="v-pills-reports-tab" data-toggle="pill" href="#reports" role="tab"
            aria-controls="reports" aria-selected="false" onclick="switchTab('reports', this)">Reportes</a>
          <a class="nav-link" id="v-pills-payments-admin-tab" data-toggle="pill" href="#payments-admin" role="tab"
            aria-controls="payments-admin" aria-selected="false" onclick="switchTab('payments-admin', this)">Gestión
            de
            Pagos</a>
          <a class="nav-link" id="v-pills-attendance-admin-tab" data-toggle="pill" href="#attendance-admin" role="tab"
            aria-controls="attendance-admin" aria-selected="false" onclick="switchTab('attendance-admin', this)">Gestión
            de Asistencia</a>
        </div>
      </div>

      <!--FOrmularios-->
      <div class="modal fade" id="addProfessorModal" tabindex="-1" role="dialog"
        aria-labelledby="addProfessorModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="addProfessorModalLabel">Agregar Nuevo Profesor</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <form id="add-professor-form">
                <div class="form-group">
                  <label for="add-professor-name">Nombre</label>
                  <input type="text" class="form-control" id="add-professor-name" required>
                </div>
                <div class="form-group">
                  <label for="add-professor-phone">Celular</label>
                  <input type="text" class="form-control" id="add-professor-phone">
                </div>
                <div class="form-group">
                  <label for="add-professor-email">Email</label>
                  <input type="email" class="form-control" id="add-professor-email" required>
                </div>
                <div class="form-group">
                  <label for="add-professor-password">Contraseña</label>
                  <input type="password" class="form-control" id="add-professor-password" required>
                </div>
                <button type="submit" class="btn btn-primary action-button">Guardar Profesor</button>
              </form>
            </div>
          </div>
        </div>
      </div>

      <div class="modal fade" id="editProfessorModal" tabindex="-1" role="dialog"
        aria-labelledby="editProfessorModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="editProfessorModalLabel">Editar Profesor</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <form id="edit-professor-form">
                <input type="hidden" id="edit-professor-id-hidden">
                <div class="form-group">
                  <label for="edit-professor-name">Nombre</label>
                  <input type="text" class="form-control" id="edit-professor-name" required>
                </div>
                <div class="form-group">
                  <label for="edit-professor-phone">Celular</label>
                  <input type="text" class="form-control" id="edit-professor-phone">
                </div>
                <div class="form-group">
                  <label for="edit-professor-email">Email</label>
                  <input type="email" class="form-control" id="edit-professor-email" required>
                </div>
                <button type="submit" class="btn btn-primary action-button">Actualizar Profesor</button>
              </form>
            </div>
          </div>
        </div>
      </div>

      <div class="modal fade" id="addSubjectModal" tabindex="-1" role="dialog" aria-labelledby="addSubjectModalLabel"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="addSubjectModalLabel">Agregar Nueva Materia</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <form id="add-subject-form">
                <div class="form-group">
                  <label for="add-subject-name">Nombre de la Materia</label>
                  <input type="text" class="form-control" id="add-subject-name" required>
                </div>
                <div class="form-group">
                  <label for="add-subject-semester">Semestre Cursante</label>
                  <input type="number" class="form-control" id="add-subject-semester" min="1" required>
                </div>
                <button type="submit" class="btn btn-primary action-button">Guardar Materia</button>
              </form>
            </div>
          </div>
        </div>
      </div>

      <div class="modal fade" id="editSubjectModal" tabindex="-1" role="dialog" aria-labelledby="editSubjectModalLabel"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="editSubjectModalLabel">Editar Materia</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <form id="edit-subject-form">
                <input type="hidden" id="edit-subject-id-hidden">
                <div class="form-group">
                  <label for="edit-subject-name">Nombre de la Materia</label>
                  <input type="text" class="form-control" id="edit-subject-name" required>
                </div>
                <div class="form-group">
                  <label for="edit-subject-semester">Semestre Cursante</label>
                  <input type="number" class="form-control" id="edit-subject-semester" min="1" required>
                </div>
                <button type="submit" class="btn btn-primary action-button">Actualizar Materia</button>
              </form>
            </div>
          </div>
        </div>
      </div>

      <div class="modal fade" id="editStudentModal" tabindex="-1" role="dialog" aria-labelledby="editStudentModalLabel"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="editStudentModalLabel">Editar Estudiante</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <form id="edit-student-form">
                <input type="hidden" id="edit-student-original-matricula">

                <div class="form-group">
                  <label for="edit-student-matricula">Matrícula</label>
                  <input type="text" class="form-control" id="edit-student-matricula" readonly>
                </div>
                <div class="form-group">
                  <label for="edit-student-name">Nombre</label>
                  <input type="text" class="form-control" id="edit-student-name" required>
                </div>
                <div class="form-group">
                  <label for="edit-student-carrera">Carrera</label>
                  <input type="text" class="form-control" id="edit-student-carrera" required>
                </div>
                <div class="form-group">
                  <label for="edit-student-semestre">Semestre</label>
                  <input type="number" class="form-control" id="edit-student-semestre" min="1" required>
                </div>
                <div class="form-group">
                  <label for="edit-student-phone">Celular</label>
                  <input type="text" class="form-control" id="edit-student-phone">
                </div>
                <div class="form-group">
                  <label for="edit-student-email">Email</label>
                  <input type="email" class="form-control" id="edit-student-email" required>
                </div>
                <button type="submit" class="btn btn-primary action-button">Actualizar Estudiante</button>
              </form>
            </div>
          </div>
        </div>
      </div>
      <!-- Forms xd -->

      <div class="modal fade" id="addStudentModal" tabindex="-1" role="dialog" aria-labelledby="addStudentModalLabel"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="addStudentModalLabel">Agregar Nuevo Estudiante</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <form id="add-student-form">
                <div class="form-group">
                  <label for="add-matricula">Matrícula</label>
                  <input type="text" class="form-control" id="add-matricula" required>
                </div>
                <div class="form-group">
                  <label for="add-student-name">Nombre</label>
                  <input type="text" class="form-control" id="add-student-name" required>
                </div>
                <div class="form-group">
                  <label for="add-carrera">Carrera</label>
                  <input type="text" class="form-control" id="add-carrera" required>
                </div>
                <div class="form-group">
                  <label for="add-semestre">Semestre</label>
                  <input type="number" class="form-control" id="add-semestre" min="1" required>
                </div>
                <div class="form-group">
                  <label for="add-student-phone">Celular</label>
                  <input type="text" class="form-control" id="add-student-phone">
                </div>
                <div class="form-group">
                  <label for="add-student-email">Email</label>
                  <input type="email" class="form-control" id="add-student-email" required>
                </div>
                <div class="form-group">
                  <label for="add-student-password">Contraseña</label>
                  <input type="password" class="form-control" id="add-student-password" required>
                </div>
                <button type="submit" class="btn btn-primary action-button">Guardar Estudiante</button>
              </form>
            </div>
          </div>
        </div>
      </div>

      <div class="tab-pane fade show active" id="students-management" role="tabpanel" aria-labelledby="admin-students-tab">
        <h3 class="d-inline-block">Gestión de Estudiantes</h3>
        <button class="btn btn-success float-right mb-3" data-toggle="modal" data-target="#addStudentModal">Agregar
          Estudiante</button>
        <table class="table table-bordered mt-3">
          <thead>
            <tr>
              <th>Matrícula</th>
              <th>Nombre</th>
              <th>Carrera</th>
              <th>Semestre</th>
              <th>Celular</th>
              <th>Email</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody id="admin-student-table">
          </tbody>
        </table>
      </div>

      <div class="tab-pane fade" id="professor-management" role="tabpanel" aria-labelledby="v-pills-professor-mgmt-tab">
        <h3 class="mb-3">Gestión de Profesores</h3>
        <button class="btn btn-success action-button mb-3" data-toggle="modal" data-target="#addProfessorModal"
          href="#addProfessorModal">Agregar Profesor</button>
        <div class="table-responsive">
          <table class="table table-hover table-striped">
            <thead class="thead-dark">
              <tr>
                <th>ID Profesor</th>
                <th>Nombre</th>
                <th>Celular</th>
                <th>Email</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody id="admin-professor-table">

            </tbody>
          </table>
        </div>
      </div>

      <div class="tab-pane fade" id="subject-management" role="tabpanel" aria-labelledby="v-pills-subject-mgmt-tab">
        <h3 class="mb-3">Gestión de Materias</h3>
        <button class="btn btn-success action-button mb-3" data-toggle="modal" data-target="#addSubjectModal">Agregar
          Materia</button>
        <div class="table-responsive">
          <table class="table table-hover table-striped">
            <thead class="thead-dark">
              <tr>
                <th>ID Materia</th>
                <th>Nombre</th>
                <th>Semestre Cursante</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody id="admin-subject-table">
            </tbody>
          </table>
        </div>
        <h4 class="mt-4">Asignar Materias a Profesores</h4>
        <div class="card p-3 shadow-sm mb-3">
          <div class="form-group">
            <label for="assign_prof_subject">Profesor</label>
            <select id="assign_prof_subject" class="form-control"></select>
          </div>
          <div class="form-group">
            <label for="assign_subject_group">Materia y Grupo</label>
            <select id="assign_subject_group" class="form-control"></select>
          </div>
          <button class="btn btn-primary action-button">Asignar</button>
        </div>
        <h4 class="mt-4">Asignar Materias a Estudiantes (Grupos)</h4>
        <div class="card p-3 shadow-sm">
          <div class="form-group">
            <label for="assign_student_subject">Estudiante</label>
            <select id="assign_student_subject" class="form-control"></select>
          </div>
          <div class="form-group">
            <label for="assign_student_group">Materia y Grupo</label>
            <select id="assign_student_group" class="form-control"></select>
          </div>
          <button class="btn btn-primary action-button">Asignar</button>
        </div>
      </div>
      <div class="tab-pane fade" id="reports" role="tabpanel" aria-labelledby="v-pills-reports-tab">
        <h3 class="mb-3">Reportes</h3>
        <p>Generación de reportes académicos y administrativos.</p>
        <button class="btn btn-secondary action-button mr-2">Reporte de Calificaciones</button>
        <button class="btn btn-secondary action-button">Reporte de Asistencias</button>
      </div>
      <div class="tab-pane fade" id="payments-admin" role="tabpanel" aria-labelledby="v-pills-payments-admin-tab">
        <h3 class="mb-3">Gestión de Pagos</h3>
        <button class="btn btn-success action-button mb-3" data-toggle="modal" data-target="#addPaymentModal">Registrar
          Pago</button>
        <div class="table-responsive">
          <table class="table table-hover table-striped">
            <thead class="thead-dark">
              <tr>
                <th>Matrícula</th>
                <th>Ciclo</th>
                <th>Fecha Vencimiento</th>
                <th>Fecha Pago</th>
                <th>Monto</th>
                <th>Estado</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody id="admin-payments-table">
              <tr>
                <td>A001</td>
                <td>2025-1</td>
                <td>2025-01-31</td>
                <td>2025-01-28</td>
                <td>$1500.00</td>
                <td>Pagado</td>
                <td>
                  <button class="btn btn-sm btn-info mr-2">Detalles</button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <div class="tab-pane fade" id="attendance-admin" role="tabpanel" aria-labelledby="v-pills-attendance-admin-tab">
        <h3 class="mb-3">Gestión de Asistencia</h3>
        <p>Visualización y gestión de registros de asistencia por materia/grupo.</p>
        <div class="form-group">
          <label for="attendance_subject_group">Filtrar por Materia y Grupo</label>
          <select id="attendance_subject_group" class="form-control"></select>
        </div>
        <div class="table-responsive mt-3">
          <table class="table table-hover table-striped">
            <thead class="thead-dark">
              <tr>
                <th>Fecha/Hora</th>
                <th>Matrícula</th>
                <th>Materia</th>
                <th>Código</th>
                <th>Ciclo</th>
              </tr>
            </thead>
            <tbody id="admin-attendance-table">
              <tr>
                <td>2025-06-10 09:00:00</td>
                <td>A001</td>
                <td>MAT101</td>
                <td>ABC123</td>
                <td>2025-1</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>








  </div>
  </div>

  <div id="super-admin-content" class="content-section container-fluid">
    <nav class="navbar navbar-expand-lg navbar-light bg-light shadow-sm mb-4">
      <a class="navbar-brand" href="#">Administración del Sistema</a>
      <div class="ml-auto">
        <button class="btn btn-outline-danger logout-button" onclick="handleLogout()">Cerrar sesión</button>
      </div>
    </nav>
    <div class="row">
      <div class="col-md-3 col-lg-2">
        <div class="nav flex-column nav-pills custom-nav-pills" id="v-pills-tab-superadmin" role="tablist"
          aria-orientation="vertical">
          <a class="nav-link active" id="v-pills-user-mgmt-tab" data-toggle="pill" href="#user-management" role="tab"
            aria-controls="user-management" aria-selected="true"
            onclick="switchTab('user-management', this)">Usuarios</a>
          <a class="nav-link" id="v-pills-system-config-tab" data-toggle="pill" href="#system-config" role="tab"
            aria-controls="system-config" aria-selected="false"
            onclick="switchTab('system-config', this)">Configuraciones</a>
          <a class="nav-link" id="v-pills-system-logs-tab" data-toggle="pill" href="#system-logs" role="tab"
            aria-controls="system-logs" aria-selected="false" onclick="switchTab('system-logs', this)">Registros</a>
        </div>
      </div>

      <div class="modal fade" id="addUserModal" tabindex="-1" role="dialog" aria-labelledby="addUserModalLabel"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="addUserModalLabel">Agregar Nuevo Usuario</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <form id="add-user-form">
                <div class="form-group">
                  <label for="add-username">Nombre de Usuario</label>
                  <input type="text" class="form-control" id="add-username" required>
                </div>
                <div class="form-group">
                  <label for="add-user-password">Contraseña</label>
                  <input type="password" class="form-control" id="add-user-password" required>
                </div>
                <div class="form-group">
                  <label for="add-user-role">Rol</label>
                  <select class="form-control" id="add-user-role" required>
                    <option value="">Seleccione un rol</option>
                    <option value="1">Estudiante</option>
                    <option value="2">Profesor</option>
                    <option value="3">Administrativo</option>
                    <option value="99">Super Administrador</option>
                  </select>
                </div>
                <button type="submit" class="btn btn-primary action-button">Guardar Usuario</button>
              </form>
            </div>
          </div>
        </div>
      </div>
      <!---->
      <div class="modal fade" id="editUserModal" tabindex="-1" role="dialog" aria-labelledby="editUserModalLabel"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="editUserModalLabel">Editar Usuario</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <form id="edit-user-form">
                <input type="hidden" id="edit-user-id-hidden">
                <div class="form-group">
                  <label for="edit-username">Nombre de Usuario</label>
                  <input type="text" class="form-control" id="edit-username" required>
                </div>
                <div class="form-group">
                  <label for="edit-user-role">Rol</label>
                  <select class="form-control" id="edit-user-role" required>
                    <option value="">Seleccione un rol</option>
                    <option value="1">Estudiante</option>
                    <option value="2">Profesor</option>
                    <option value="3">Administrativo</option>
                    <option value="99">Super Administrador</option>
                  </select>
                </div>
                <button type="submit" class="btn btn-primary action-button">Actualizar Usuario</button>
              </form>
            </div>
          </div>
        </div>
      </div>
      <!---->
      <div class="col-md-9 col-lg-10">
        <div class="tab-content" id="v-pills-tabContent-superadmin">
          <div class="tab-pane fade show active" id="user-management" role="tabpanel"
            aria-labelledby="v-pills-user-mgmt-tab">
            <h3 class="mb-3">Gestión de Usuarios</h3>
            <button class="btn btn-success action-button mb-3" data-toggle="modal" data-target="#addUserModal">Agregar
              Usuario</button>
            <div class="table-responsive">
              <table class="table table-hover table-striped">
                <thead class="thead-dark">
                  <tr>
                    <th>ID Usuario</th>
                    <th>Nombre de Usuario</th>
                    <th>Rol</th>
                    <th>Acciones</th>
                  </tr>
                </thead>
                <tbody id="superadmin-user-table">
                  <tr>
                    <td>U001</td>
                    <td>admin_user</td>
                    <td>Admin</td>
                    <td>
                      <button class="btn btn-sm btn-info mr-2" data-target="#editUserModal">Editar</button>
                      <button class="btn btn-sm btn-danger" onclick="deleteRegister">Eliminar</button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          <div class="tab-pane fade" id="system-config" role="tabpanel" aria-labelledby="v-pills-system-config-tab">
            <h3 class="mb-3">Configuraciones del Sistema</h3>
            <p>Formularios para configurar parámetros globales del sistema, como ciclos escolares, notificaciones, etc.
            </p>
            <form>
              <div class="form-group">
                <label for="current_cycle">Ciclo Actual</label>
                <input type="text" id="current_cycle" class="form-control" value="2025-1">
              </div>
              <button class="btn btn-primary action-button">Guardar Configuración</button>
            </form>
          </div>
          <div class="tab-pane fade" id="system-logs" role="tabpanel" aria-labelledby="v-pills-system-logs-tab">
            <h3 class="mb-3">Registros del Sistema</h3>
            <p>Visualización de logs de actividad y errores del sistema.</p>
            <div class="table-responsive">
              <table class="table table-hover table-striped">
                <thead class="thead-dark">
                  <tr>
                    <th>Fecha/Hora</th>
                    <th>Tipo</th>
                    <th>Mensaje</th>
                  </tr>
                </thead>
                <tbody id="superadmin-logs-table">
                  <tr>
                    <td>2025-06-10 10:30:00</td>
                    <td>INFO</td>
                    <td>User 'admin_user' logged in.</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
    integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
    integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
    integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
    crossorigin="anonymous"></script>
  <script src="https://cdn.datatables.net/2.2.2/js/dataTables.min.js"></script>
  <script src="https://cdn.rawgit.com/davidshimjs/qrcodejs/gh-pages/qrcode.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
    integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
    integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
    crossorigin="anonymous"></script>



  <script>
    // Roles
    const ROLES = {
      STUDENT: 1,
      PROFESSOR: 2,
      ADMIN_STAFF: 3,
      SUPER_ADMIN: 99
    };

    async function fetchData(url, method = 'GET', data = null) {
      try {
        const token = localStorage.getItem('authToken'); // Obtener el token de localStorage
        const headers = {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${token}` // Incluir el token en el encabezado
        };

        const config = {
          method: method,
          headers: headers,
        };

        if (data) {
          config.body = JSON.stringify(data);
        }

        const response = await fetch(url, config);
        if (!response.ok) {
          let errorMessage = `HTTP error! status: ${response.status}`;
          try {
            const errorData = await response.json();
            errorMessage = errorData.message || errorMessage;
          } catch (e) {
            console.error('Error parsing error response:', e);
          }
          throw new Error(errorMessage);
        }


        if (response.status === 204) {
          return {};
        }

        return await response.json();
      } catch (error) {
        console.error('Error in fetchData:', error);
        throw error;
      }
    }


    function getBackendIP() {
      let backendIP = localStorage.getItem('backendIP');
      backendIP = "192.168.100.20";
      if (backendIP) {
        localStorage.setItem('backendIP', backendIP);
      } else {
        alert("Backend IP is required!");
        return null;
      } return backendIP;
    }

    var backendIP = getBackendIP();


    // cambia paginas
    function switchTab(tabId, element) {
      // Remove active class from all tabs and tab content
      document.querySelectorAll('.nav-link').forEach(tab => { tab.classList.remove('active'); }); // Corrected selector for Bootstrap nav-pills
      // Bootstrap handles tab content activation with data-toggle="pill" and href, so direct content class manipulation might not be needed if using Bootstrap's JS.
      // However, keeping for explicit control if needed.
      document.querySelectorAll('.tab-pane').forEach(content => { content.classList.remove('show', 'active'); }); // Corrected selector for Bootstrap tab-pane

      // Set active class to the current tab and content
      element.classList.add('active');
      document.getElementById(tabId).classList.add('show', 'active'); // Bootstrap requires 'show' and 'active' for fading tabs

      // Switch to the appropriate tab content
      try {
        switch (tabId) {
          case 'enrolled-subjects': loadSubjects(); break;
          case 'subjects-student': loadSubjectsStudent(); break;
          case 'students': loadStudents(); break;
          case 'professors': loadProfessors(); break;
          case 'users': loadUsers(); break;
          case 'subjects': loadSubjects(); break;
          case 'student-grades': loadGrades(); break;
          case 'student-kardex': loadKardez(); break;
          case 'grades': loadGrades(); break;
          case 'kardex': loadKardez(); break;
          case 'payments': loadPagos(); break;
          case 'attendance': initializeAttendance(); break;
          case 'teaching-schedule': loadSubjectsProf(); break;
          case 'attendance-qr': QR_CODE_GEN(); break;
          case 'profesor_grade_entry': fetchSubjects(); break;
          // Admin and Super Admin tabs will need their respective load functions
          // For now, these are placeholders. Actual data loading functions would be added here.
          case 'student-management': console.log('Loading student management...'); break;
          case 'professor-management': console.log('Loading professor management...'); break;
          case 'subject-management': console.log('Loading subject management...'); break;
          case 'professor-management': console.log('Loading professor management...'); break;
          case 'subject-management': console.log('Loading subject management...'); break;
          case 'reports': console.log('Loading reports...'); break;
          case 'payments-admin': console.log('Loading admin payments...'); break;
          case 'attendance-admin': console.log('Loading admin attendance...'); break;
          case 'user-management': console.log('Loading user management...'); break;
          case 'system-config': console.log('Loading system configuration...'); break;
          case 'system-logs': console.log('Loading system logs...'); break;
          default: console.warn(`No handler for tabId: ${tabId}`);
        }
      } catch (error) {
        console.error(`Error loading content for tab ${tabId}:`, error);
      }
    }

    // Logout
    function handleLogout() {
      localStorage.removeItem('authToken');
      showUserRole(null);
      document.getElementById('username').value = '';
      document.getElementById('password').value = '';
    }

    // Login hanlder
    document.getElementById('login-form').addEventListener('submit', async (e) => {
      e.preventDefault();

      const username = document.getElementById('username').value;
      const password = document.getElementById('password').value;
      const errorMessage = document.getElementById('error-message');
      try {
        let ip = backendIP;
        console.log(backendIP);
        const response = await fetch(`http://${backendIP}:3000/login`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ username, password })
        });

        const data = await response.json();

        if (response.ok) {
          localStorage.setItem('authToken', data.token);
          errorMessage.textContent = '';
          showUserRole(data.user_role);
          console.log('Login successful:', data.user_role);
        } else { errorMessage.textContent = data.message || 'Login failed'; }
      } catch (error) {
        errorMessage.textContent = 'Connection error. Please try again.';
        console.error('Login error:', error);
      }

    });

    function showUserRole(role) {
      document.querySelectorAll('.content-section').forEach(section => { section.style.display = 'none'; });

      switch (parseInt(role)) {
        case ROLES.SUPER_ADMIN:
          document.getElementById('super-admin-content').style.display = 'block';
          loadStudents();
          loadProfessors();
          loadSubjects();
          loadUsers();
          loadPagos();
          loadAttendance();
          break;
        case ROLES.PROFESSOR:
          document.getElementById('professor-content').style.display = 'block';
          loadStudents();
          loadSubjectsProf();
          fetchSubjects();
          break;
        case ROLES.STUDENT: document.getElementById('student-content').style.display = 'block';
          loadGrades();
          loadSubjects();
          loadSubjectsStudent();
          loadKardez();
          loadPagos();

          break;
        case ROLES.ADMIN_STAFF:
          document.getElementById('admin-staff-content').style.display = 'block';
          loadStudents();
          loadProfessors();
          loadSubjects();
          loadPagos();
          loadAttendance();
          loadUsers();

          break;
        default: document.getElementById('login-content').style.display = 'block';
      }
    }

    //
    window.addEventListener('load', () => {
      const token = localStorage.getItem('authToken');
      if (token) {
        try {
          const payload = JSON.parse(atob(token.split('.')[1]));
          showUserRole(payload.user_role);
        } catch (error) {
          localStorage.removeItem('authToken');
          showUserRole(null);
        }
      } else { showUserRole(null); }
    });

    //////////////////GENERICO/(/////////////////)
    //////////////////////////////////////////                 ADD Registros                  //////////////////////////////////////////////////
    // --- Estudiantes ---
    document.getElementById('add-student-form').addEventListener('submit', async function (event) {
      event.preventDefault();
      const studentData = {
        matricula: document.getElementById('add-matricula').value,
        nombre: document.getElementById('add-student-name').value,
        carrera: document.getElementById('add-carrera').value,
        semestre: parseInt(document.getElementById('add-semestre').value),
        celular: document.getElementById('add-student-phone').value,
        email: document.getElementById('add-student-email').value,
        contrasena: document.getElementById('add-student-password').value // Asegúrate de que tu backend hashee esto
      };
      try {
        await fetchData(`http://${backendIP}:3000/students`, 'POST', studentData);
        alert('Estudiante agregado exitosamente!');
        $('#addStudentModal').modal('hide'); // Cierra el modal
        this.reset(); // Limpia el formulario
        loadStudents(); // Recarga la tabla de estudiantes
      } catch (error) {
        console.error("Error al agregar estudiante:", error);
      }
    });

    document.getElementById('edit-student-form').addEventListener('submit', async function (event) {
      event.preventDefault();
      const originalMatricula = document.getElementById('edit-student-original-matricula').value;
      const studentData = {
        nombre: document.getElementById('edit-student-name').value,
        carrera: document.getElementById('edit-student-carrera').value,
        semestre: parseInt(document.getElementById('edit-student-semestre').value),
        celular: document.getElementById('edit-student-phone').value,
        email: document.getElementById('edit-student-email').value,

      };
      try {

        await fetchData(`http://${backendIP}:3000/students/${originalMatricula}`, 'PUT', studentData);
        alert('Estudiante actualizado exitosamente!');
        $('#editStudentModal').modal('hide');
        loadStudents();
      } catch (error) {
        console.error("Error al actualizar estudiante:", error);
      }
    });

    // --- Profesores ---
    document.getElementById('add-professor-form').addEventListener('submit', async function (event) {
      event.preventDefault();
      const professorData = {
        nombre: document.getElementById('add-professor-name').value,
        celular: document.getElementById('add-professor-phone').value,
        email: document.getElementById('add-professor-email').value,
        contrasena: document.getElementById('add-professor-password').value
      };
      try {
        await fetchData(`http://${backendIP}:3000/professors`, 'POST', professorData);
        alert('Profesor agregado exitosamente!');
        $('#addProfessorModal').modal('hide');
        this.reset();
        loadProfessors();
      } catch (error) {
        console.error("Error al agregar profesor:", error);
      }
    });

    document.getElementById('edit-professor-form').addEventListener('submit', async function (event) {
      event.preventDefault();
      const professorId = document.getElementById('edit-professor-id-hidden').value;
      const professorData = {
        nombre: document.getElementById('edit-professor-name').value,
        celular: document.getElementById('edit-professor-phone').value,
        email: document.getElementById('edit-professor-email').value,
      };
      try {
        await fetchData(`http://${backendIP}:3000/professors/${professorId}`, 'PUT', professorData);
        alert('Profesor actualizado exitosamente!');
        $('#editProfessorModal').modal('hide');
        loadProfessors();
      } catch (error) {
        console.error("Error al actualizar profesor:", error);
      }
    });

    // --- Materias ---
    document.getElementById('add-subject-form').addEventListener('submit', async function (event) {
      event.preventDefault();
      const subjectData = {
        nombre: document.getElementById('add-subject-name').value,
        semestre_cursante: parseInt(document.getElementById('add-subject-semester').value),
      };
      try {
        await fetchData(`http://${backendIP}:3000/subjects`, 'POST', subjectData);
        alert('Materia agregada exitosamente!');
        $('#addSubjectModal').modal('hide');
        this.reset();
        loadSubjects();
      } catch (error) {
        console.error("Error al agregar materia:", error);
      }
    });

    document.getElementById('edit-subject-form').addEventListener('submit', async function (event) {
      event.preventDefault();
      const subjectId = document.getElementById('edit-subject-id-hidden').value;
      const subjectData = {
        nombre: document.getElementById('edit-subject-name').value,
        semestre_cursante: parseInt(document.getElementById('edit-subject-semester').value),
      };
      try {
        await fetchData(`http://${backendIP}:3000/subjects/${subjectId}`, 'PUT', subjectData);
        alert('Materia actualizada exitosamente!');
        $('#editSubjectModal').modal('hide');
        loadSubjects();
      } catch (error) {
        console.error("Error al actualizar materia:", error);
      }
    });

    // --- Usuarios (Super Administrador) ---
    document.getElementById('add-user-form').addEventListener('submit', async function (event) {
      event.preventDefault();
      const userData = {
        nombre_usuario: document.getElementById('add-username').value,
        contrasena: document.getElementById('add-user-password').value,
        id_rol: parseInt(document.getElementById('add-user-role').value),
      };
      try {
        await fetchData(`http://${backendIP}:3000/users`, 'POST', userData);
        //alert('Usuario agregado exitosamente!');
        $('#addUserModal').modal('hide');
        this.reset();
        loadUsers();
      } catch (error) {
        console.error("Error al agregar usuario:", error);
      }
    });

    document.getElementById('edit-user-form').addEventListener('submit', async function (event) {
      event.preventDefault();
      const userId = document.getElementById('edit-user-id-hidden').value;
      const userData = {
        nombre_usuario: document.getElementById('edit-username').value,
        id_rol: parseInt(document.getElementById('edit-user-role').value),
      };
      try {
        await fetchData(`http://${backendIP}:3000/users/${userId}`, 'PUT', userData);
        alert('Usuario actualizado exitosamente!');
        $('#editUserModal').modal('hide');
        loadUsers();
      } catch (error) {
        console.error("Error al actualizar usuario:", error);
      }
    });

    ///////////////////////////////////////////////////////       LECTURA DE DAATOS      ////////////////////////////////////////////////////////////////////////////////

    async function loadStudents() {
      try {
        const students = await fetchData(`http://${backendIP}:3000/students`); // Asegúrate de que esta URL sea correcta para tu API
        const tbody = document.getElementById("admin-student-table");
        tbody.innerHTML = ""; // Limpia la tabla antes de cargar

        students.forEach(student => {
          const row = `<tr>
            <td>${student.matricula}</td>
            <td>${student.nombre}</td>
            <td>${student.carrera}</td>
            <td>${student.semestre}</td>
            <td>${student.celular || ''}</td>
            <td>${student.email || ''}</td>
            <td>
              <button class="btn btn-sm btn-info mr-2"
                      data-toggle="modal" data-target="#editStudentModal"
                      onclick="openEditStudentModal('${student.matricula}', '${student.nombre}', '${student.carrera}', ${student.semestre}, '${student.celular || ''}', '${student.email || ''}')">
                Editar
              </button>
              <button class="btn btn-sm btn-danger" onclick="deleteStudent('${student.matricula}')">Eliminar</button>
            </td>
          </tr>`;
          tbody.innerHTML += row;
        });
        // Inicializar o recargar DataTables si lo estás usando
        // $('#adminStudentTable').DataTable();
      } catch (error) {
        console.error("Error al cargar estudiantes:", error);
      }
    }

    async function loadProfessors() {
      try {
        const professors = await fetchData(`http://${backendIP}:3000/professors`); // Asegúrate de que esta URL sea correcta
        const tbody = document.getElementById("admin-professor-table");
        tbody.innerHTML = "";

        professors.forEach(prof => {
          const row = `<tr>
            <td>${prof.id}</td>
            <td>${prof.nombre}</td>
            <td>${prof.celular || ''}</td>
            <td>${prof.email || ''}</td>
            <td>
              <button class="btn btn-sm btn-info mr-2"
                      data-toggle="modal" data-target="#editProfessorModal"
                      onclick="openEditProfessorModal('${prof.id}', '${prof.nombre}', '${prof.celular || ''}', '${prof.email || ''}')">
                Editar
              </button>
              <button class="btn btn-sm btn-danger" onclick="deleteProfessor('${prof.id}')">Eliminar</button>
            </td>
          </tr>`;
          tbody.innerHTML += row;
        });
        // $('#adminProfessorTable').DataTable();
      } catch (error) {
        console.error("Error al cargar profesores:", error);
      }
    }

    async function loadSubjects() {
      try {
        const subjects = await fetchData(`http://${backendIP}:3000/subjects`); // Asegúrate de que esta URL sea correcta
        const tbody = document.getElementById("admin-subject-table");
        tbody.innerHTML = "";

        subjects.forEach(subject => {
          const row = `<tr>
            <td>${subject.id}</td>
            <td>${subject.nombre}</td>
            <td>${subject.semestre_cursante}</td>
            <td>
              <button class="btn btn-sm btn-info mr-2"
                      data-toggle="modal" data-target="#editSubjectModal"
                      onclick="openEditSubjectModal('${subject.id}', '${subject.nombre}', ${subject.semestre_cursante})">
                Editar
              </button>
              <button class="btn btn-sm btn-danger" onclick="deleteSubject('${subject.id}')">Eliminar</button>
            </td>
          </tr>`;
          tbody.innerHTML += row;
        });
        // $('#adminSubjectTable').DataTable();
      } catch (error) {
        console.error("Error al cargar materias:", error);
      }
    }

    async function loadUsers() {
      try {
        const users = await fetchData(`http://${backendIP}:3000/users`); // Asegúrate de que esta URL sea correcta
        const tbody = document.getElementById("admin-user-table");
        tbody.innerHTML = "";

        users.forEach(user => {

          const roleName = {
            '1': 'Estudiante',
            '2': 'Profesor',
            '3': 'Administrativo',
            '99': 'Super Administrador'
          }[user.id_rol] || 'Desconocido';

          const row = `<tr>
            <td>${user.id_usuario}</td>
            <td>${user.nombre_usuario}</td>
            <td>${roleName}</td>
            <td>
              <button class="btn btn-sm btn-info mr-2"
                      data-toggle="modal" data-target="#editUserModal"
                      onclick="openEditUserModal('${user.id_usuario}', '${user.nombre_usuario}', '${user.id_rol}')">
                Editar
              </button>
              <button class="btn btn-sm btn-danger" onclick="deleteUser('${user.id_usuario}')">Eliminar</button>
            </td>
          </tr>`;
          tbody.innerHTML += row;
        });
        // $('#adminUserTable').DataTable();
      } catch (error) {
        console.error("Error al cargar usuarios:", error);
      }
    }
    /////////////////////EDICION MODALES/(/////////////////)
    function openEditStudentModal(matricula, nombre, carrera, semestre, celular, email) {
      document.getElementById('edit-student-original-matricula').value = matricula;
      document.getElementById('edit-student-matricula').value = matricula;
      document.getElementById('edit-student-name').value = nombre;
      document.getElementById('edit-student-carrera').value = carrera;
      document.getElementById('edit-student-semestre').value = semestre;
      document.getElementById('edit-student-phone').value = celular;
      document.getElementById('edit-student-email').value = email;
    }

    function openEditProfessorModal(id, nombre, celular, email) {
      document.getElementById('edit-professor-id-hidden').value = id;
      document.getElementById('edit-professor-name').value = nombre;
      document.getElementById('edit-professor-phone').value = celular;
      document.getElementById('edit-professor-email').value = email;
    }

    function openEditSubjectModal(id, nombre, semestre) {
      document.getElementById('edit-subject-id-hidden').value = id;
      document.getElementById('edit-subject-name').value = nombre;
      document.getElementById('edit-subject-semester').value = semestre;
    }

    function openEditUserModal(id_usuario, nombre_usuario, id_rol) {
      document.getElementById('edit-user-id-hidden').value = id_usuario;
      document.getElementById('edit-username').value = nombre_usuario;
      document.getElementById('edit-user-role').value = id_rol;
    }

    /////////////////       MATERIAS-ESTUDIANTES      ////////////////////////////////////////////
    async function loadSubjectsStudent() {
      const token = localStorage.getItem("authToken");
      const response = await fetch(`http://${backendIP}:3000/student/tabla-datos-estudiante/`, { headers: { "Authorization": `Bearer ${token}` } });
      console.log("Token:", localStorage.getItem("authToken"));

      if (!response.ok) {
        console.error("Error al obtener las materias");
        return;
      }

      const subjects = await response.json();
      const tbody = document.getElementById("subjects-table");
      tbody.innerHTML = "";

      subjects.forEach(subject => {
        const row = `<tr>
        <td>${subject.materia_nombre}</td>
        <td>${subject.profesor_nombre}</td>
        <td>${subject.horarios}</td>
        <td>${subject.id_grupo}</td>
        </tr>`;
        tbody.innerHTML += row;
      });
    }

    /////////////////       CALIFICACIONES       ////////////////////////////////////////////
    async function loadGrades() {
      const token = localStorage.getItem("authToken");
      const response = await fetch(`http://${backendIP}:3000/student/tabla-calificaciones/`, { headers: { "Authorization": `Bearer ${token}` } });;

      if (!response.ok) {
        console.error("Error al obtener las materias");
        return;
      }

      const subjects = await response.json();
      const tbody = document.getElementById("grades-table");
      tbody.innerHTML = "";

      subjects.forEach(subject => {
        const row = `<tr>
        <td>${subject.materia}</td>
        <td>${subject.calif_p1}</td>
        <td>${subject.calif_p2}</td>
        <td>${subject.calif_final}</td>
        <td>${subject.promedio}</td>
        </tr>`;
        tbody.innerHTML += row;
      });
    }

    /////////////////       KARDEZ       ////////////////////////////////////////////
    async function loadKardez() {
      const token = localStorage.getItem("authToken");
      const response = await fetch(`http://${backendIP}:3000/student/tabla-kardez/`, { headers: { "Authorization": `Bearer ${token}` } });;

      if (!response.ok) {
        console.error("Error al obtener las materias");
        return;
      }

      const subjects = await response.json();
      const tbody = document.getElementById("kardex-table");
      tbody.innerHTML = "";

      subjects.forEach(subject => {
        const row = `<tr>
        <td>${subject.materia}</td>
        <td>${subject.periodo}</td>
        <td>${subject.calif_final}</td>
        <td>${subject.estado}</td>
    </tr>`;
        tbody.innerHTML += row;
      });
    }

    /////////////////       PAGOS       ////////////////////////////////////////////
    async function loadPagos() {
      const token = localStorage.getItem("authToken");
      const response = await fetch(`http://${backendIP}:3000/student/tabla-pagos/`, { headers: { "Authorization": `Bearer ${token}` } });;

      if (!response.ok) {
        console.error("Error al obtener las materias");
        return;
      }

      const subjects = await response.json();
      const tbody = document.getElementById("payments-table");
      tbody.innerHTML = "";

      subjects.forEach(subject => {
        const row = `<tr>
        <td>${subject.MES}</td>
        <td>${subject.CANTIDAD}</td>
        <td>${subject.FECHA_CORTE}</td>
        <td>${subject.ESTADO}</td>
        <td>${subject.ACCION}</td>
    </tr>`;
        tbody.innerHTML += row;
      });
    }

    /////////////////       ASISTENCIAS       ////////////////////////////////////////////

    async function initializeAttendance() {
      console.log("Initializing attendance section");
      const attendanceInput = document.getElementById("attendance-code");
      if (attendanceInput) {
        attendanceInput.value = "";
        attendanceInput.focus(); // Optional: focus on the input field
      }
    }


    function submitAttendance() {
      const token = localStorage.getItem("authToken");
      const attendanceCode = document.getElementById("attendance-code").value.trim();

      if (!attendanceCode) {
        alert("Por favor, ingresa un código de asistencia.");
        return;
      }

      fetch(`http://${backendIP}:3000/student/registro-asistencias/`, {
        method: "POST",
        headers: {
          "Authorization": `Bearer ${token}`,
          "Content-Type": "application/json"
        },
        body: JSON.stringify({ codigo_asistencia: attendanceCode })
      })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            alert("Asistencia registrada exitosamente.");
          } else {
            alert("Error al registrar asistencia: " + data.message);
          }
        })
        .catch(error => {
          console.log("Error:", error);
          alert("Error al conectar con el servidor.");
        });
    }




    /////////////////////////////////////////////////////////////       PROFESORES       ////////////////////////////////////////////////////////////////////////////////

    async function loadSubjectsProf() {
      const token = localStorage.getItem("authToken");
      const response = await fetch(`http://${backendIP}:3000/professor/schedule/`, { headers: { "Authorization": `Bearer ${token}` } });
      console.log("Token:", localStorage.getItem("authToken"));

      if (!response.ok) {
        console.error("Error al obtener las materias");
        return;
      }

      const subjects = await response.json();
      console.log("retorno", subjects);
      const tbody = document.getElementById("schedule-table");
      tbody.innerHTML = "";

      subjects.forEach(subject => {
        const row = `<tr>
        <td>${subject.materia_nombre}</td>
        <td>${subject.id_grupo}</td>
        <td>${subject.horarios}</td>
        </tr>`;
        tbody.innerHTML += row;
      });
    }


    ///////////////////////////////////////////QR/////////////////////////////////
    function fallbackHash(seed) {
      let hash = 0;
      for (let i = 0; i < seed.length; i++) { hash = (hash * 31 + seed.charCodeAt(i)) >>> 0; }
      return hash;
    }

    function base62Encode(num, length = 10) {
      const base62chars = "0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";
      let encoded = "";
      while (encoded.length < length) {
        encoded = base62chars[num % 62] + encoded;
        num = Math.floor(num / 62);
      }
      return encoded;
    }

    function generateShortCode(seed) {
      const numericHash = fallbackHash(seed);
      return base62Encode(numericHash);
    }

    async function QR_CODE_GEN() {
      const token = localStorage.getItem("authToken");
      const response = await fetch(`http://${backendIP}:3000/professor/QR_CODE_GEN/`, { headers: { "Authorization": `Bearer ${token}` } });
      console.log("Token:", localStorage.getItem("authToken"));

      if (!response.ok) {
        console.error("Error al obtener las materias");
        return;
      }

      const subjects = await response.json();
      console.log("retorno", subjects);

      const selectElement = document.getElementById("qr_subject_select");
      selectElement.innerHTML = "<option value=''>Seleccione una materia</option>"; // Reset dropdown

      subjects.forEach(subject => {
        const option = document.createElement("option");
        option.value = `${subject.materia_nombre}-${subject.id_grupo}`; // Combine id_materia and id_grupo as value
        option.textContent = `${subject.materia_nombre}-${subject.id_grupo}`; // Show the name and group
        selectElement.appendChild(option);
      });
    }

    document.getElementById("qr_subject_select").addEventListener("change", function () {
      const selectedValue = this.value;
      if (selectedValue) {
        const [idMateria, idGrupo] = selectedValue.split("-");
        const seed = `${idMateria}-${idGrupo}`;
        const code = generateShortCode(seed);
        console.log("Generated code:", code);
        generateQRCode(code);
      }
    });




    function generateQRCode(data) {
      const qrDisplay = document.getElementById("qr-display");
      qrDisplay.innerHTML = "";

      new QRCode(qrDisplay, {
        text: data,
        colorDark: "#000000",
        colorLight: "#ffffff",
        correctLevel: QRCode.CorrectLevel.H
      });

    }


    /////////////////CALIFICACIONES/////////////////////////////////
    let currentSubjectInfo = null;

    async function fetchSubjects() {
      const token = localStorage.getItem("authToken");
      const response = await fetch(`http://${backendIP}:3000/professor/getSubjects/`, { headers: { "Authorization": `Bearer ${token}` } });
      console.log("Token:", localStorage.getItem("authToken"));

      if (!response.ok) {
        console.error("Error al obtener las materias");
        return;
      }

      const subjects = await response.json();
      console.log("retorno", subjects);

      const selectElement = document.getElementById("professor_grade_subject_select");
      selectElement.innerHTML = "<option value=''>Seleccione una materia</option>";

      const newSelectElement = selectElement.cloneNode(true);
      selectElement.parentNode.replaceChild(newSelectElement, selectElement);

      subjects.forEach(subject => {
        console.log("aaaa");
        const option = document.createElement("option");
        option.value = `${subject.id_materia}-${subject.id_grupo}-${subject.materia_nombre}`;
        option.textContent = `${subject.id_materia}-${subject.id_grupo}-${subject.materia_nombre}`;
        newSelectElement.appendChild(option);
      });

      newSelectElement.addEventListener("change", async function () {
        const selected = this.value;
        if (!selected) return;

        const [id_materia, id_grupo, materia_nombre] = selected.split("-");

        currentSubjectInfo = {
          id_materia: id_materia,
          id_grupo: id_grupo,
          materia_nombre: materia_nombre
        };

        console.log("idmateria" + id_materia + "idgrupo" + id_grupo);
        const response = await fetch(`http://${backendIP}:3000/professor/getStudents?id_materia=${id_materia}&id_grupo=${id_grupo}`, {
          headers: { "Authorization": `Bearer ${token}` }
        });

        if (!response.ok) {
          console.error("Error al obtener los estudiantes");
          return;
        }

        const students = await response.json();
        console.log("Estudiantes:", students);
        populateStudentGradeTable(students);
      });
    }

    async function populateStudentGradeTable(students) {
      console.log("ENTRANDO A LA SECCION DE RELLENAR TABLA");
      const tbody = document.getElementById("profesor_grade_entry_table");
      tbody.innerHTML = "";

      students.forEach(student => {
        const row = document.createElement("tr");

        row.innerHTML = `
            <td>${student.user_name}</td>
            <td><input type="number" value="${student.calif_p1 ?? ''}" data-field="calif_p1" data-id="${student.matricula}" class="form-control form-control-sm" step="0.1" min="0" max="10" /></td>
            <td><input type="number" value="${student.calif_p2 ?? ''}" data-field="calif_p2" data-id="${student.matricula}" class="form-control form-control-sm" step="0.1" min="0" max="10" /></td>
            <td><input type="number" value="${student.calif_final ?? ''}" data-field="calif_final" data-id="${student.matricula}" class="form-control form-control-sm" step="0.1" min="0" max="10" /></td>
            <td><button class="btn btn-sm btn-outline-primary save-grade-btn" data-matricula="${student.matricula}" onclick="saveGrade('${student.matricula}')">Guardar</button></td>
        `;
        tbody.appendChild(row);
      });
    }

    async function saveGrade(matricula) {
      console.log("Saving grade for matricula:", matricula);

      if (!currentSubjectInfo) {
        alert("Error: No se ha seleccionado una materia");
        return;
      }

      const button = document.querySelector(`button[data-matricula="${matricula}"]`);
      const row = button.closest("tr");

      const calif_p1_input = row.querySelector('input[data-field="calif_p1"]');
      const calif_p2_input = row.querySelector('input[data-field="calif_p2"]');
      const calif_final_input = row.querySelector('input[data-field="calif_final"]');

      const data = {
        id_materia: currentSubjectInfo.id_materia,
        matricula: matricula,
        calif_p1: calif_p1_input.value || null,
        calif_p2: calif_p2_input.value || null,
        calif_final: calif_final_input.value || null,
        ciclo_cursando: "2025-1"
      };

      console.log("Data to send:", data);

      try {
        const token = localStorage.getItem("authToken");
        const response = await fetch(`http://${backendIP}:3000/professor/saveGrade`, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": `Bearer ${token}`
          }, body: JSON.stringify(data)
        });

        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }

        const result = await response.json();
        console.log("Server response:", result);
        alert(result.message || "Calificación guardada exitosamente");

        button.classList.remove('btn-outline-primary');
        button.classList.add('btn-success');
        button.textContent = "Guardado";
        setTimeout(() => {
          button.classList.remove('btn-success');
          button.classList.add('btn-outline-primary');
          button.textContent = "Guardar";
        }, 2000);

      } catch (error) {
        console.error("Error al guardar la calificación:", error);
        alert("Error al guardar la calificación: " + error.message);
      }
    }

    /////////////////////////////////////Eliminar Registros/////////////////////////////////////
    async function deleteStudent(matricula) {
      if (confirm(`¿Estás seguro de eliminar al estudiante con matrícula ${matricula}?`)) {
        try {
          await fetchData(`http://${backendIP}:3000/students/${matricula}`, 'DELETE');
          alert('Estudiante eliminado exitosamente!');
          loadStudents(); // Recarga la tabla
        } catch (error) {
          console.error("Error al eliminar estudiante:", error);
        }
      }
    }

    async function deleteProfessor(id) {
      if (confirm(`¿Estás seguro de eliminar al profesor con ID ${id}?`)) {
        try {
          await fetchData(`http://${backendIP}:3000/professors/${id}`, 'DELETE');
          alert('Profesor eliminado exitosamente!');
          loadProfessors();
        } catch (error) {
          console.error("Error al eliminar profesor:", error);
        }
      }
    }

    async function deleteSubject(id) {
      if (confirm(`¿Estás seguro de eliminar la materia con ID ${id}?`)) {
        try {
          await fetchData(`http://${backendIP}:3000/subjects/${id}`, 'DELETE');
          alert('Materia eliminada exitosamente!');
          loadSubjects();
        } catch (error) {
          console.error("Error al eliminar materia:", error);
        }
      }
    }

    async function deleteUser(id_usuario) {
      if (confirm(`¿Estás seguro de eliminar al usuario con ID ${id_usuario}?`)) {
        try {
          await fetchData(`http://${backendIP}:3000/users/${id_usuario}`, 'DELETE');
          alert('Usuario eliminado exitosamente!');
          loadUsers();
        } catch (error) {
          console.error("Error al eliminar usuario:", error);
        }
      }
    }
  </script>
  <script src="https://cdn.rawgit.com/davidshimjs/qrcodejs/gh-pages/qrcode.min.js"></script>
</body>

</html>