<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Academic Management System</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
    integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.datatables.net/2.2.2/css/dataTables.dataTables.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
    integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

  <link rel="stylesheet" href="stilazos.css">

  <style>
    body {
      font-family: "Segoe UI", Roboto, Arial, sans-serif;
      padding: 20px;
      max-width: 1200px;
      margin: 0 auto;
      background-color: #f5f7fa;
      color: #333;
    }

    .nav-tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      border-bottom: 2px solid #e0e0e0;
      padding-bottom: 10px;
    }

    .nav-tab {
      padding: 10px 18px;
      cursor: pointer;
      background: #fff;
      border: 1px solid #ccc;
      border-radius: 6px 6px 0 0;
      transition: background 0.2s, color 0.2s, border-color 0.2s;
    }

    .nav-tab:hover {
      background-color: #e9ecef;
    }

    .nav-tab.active {
      background: #0d6efd;
      color: #fff;
      border-color: #0d6efd #0d6efd #fff;
    }


    .content-section,
    .tab-content {
      display: none;
      background: #fff;
      padding: 20px;
      border: 1px solid #ddd;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
      margin-top: 20px;
    }

    .tab-content.active,
    .content-section.active {
      display: block;
    }


    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      background: #fff;
      border-radius: 6px;
      overflow: hidden;
    }

    th,
    td {
      padding: 14px;
      border: 1px solid #eee;
      text-align: left;
    }

    th {
      background-color: #f1f3f5;
      font-weight: 600;
    }


    .logout-button,
    .action-button {
      padding: 10px 18px;
      border: none;
      border-radius: 6px;
      color: #fff;
      cursor: pointer;
      font-weight: 500;
      transition: background 0.2s;
    }

    .logout-button {
      background-color: #dc3545;
      float: right;
    }

    .logout-button:hover {
      background-color: #bb2d3b;
    }

    .action-button {
      background-color: #0d6efd;
      margin: 5px;
    }

    .action-button:hover {
      background-color: #0b5ed7;
    }


    .form-group {
      margin-bottom: 16px;
    }

    .form-group label {
      display: block;
      margin-bottom: 6px;
      font-weight: 500;
    }

    .form-group input {
      width: 100%;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
      transition: border-color 0.2s;
    }

    .form-group input:focus {
      border-color: #0d6efd;
      outline: none;
    }


    .form-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(33, 37, 41, 0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 999;
    }

    .form-container {
      background: #fff;
      padding: 24px;
      border-radius: 8px;
      max-width: 480px;
      width: 100%;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .qr-section {
      text-align: center;
      margin: 24px 0;
    }

    #qr-display {
      position: fixed;
      bottom: 10%;
      left: 50%;
      transform: translateX(-50%);
      z-index: 1000;
      width: 30%;
      height: 30%;
    }
  </style>
</head>

<body>
  <div id="login-content" class="content-section d-flex justify-content-center align-items-center vh-100">
    <div class="card p-4 shadow-sm login-card">
      <h2 class="card-title text-center mb-4">Login</h2>
      <form id="login-form">
        <div class="form-group">
          <label for="username">Usuario</label>
          <input type="text" id="username" class="form-control" required>
        </div>
        <div class="form-group">
          <label for="password">Contraseña</label>
          <input type="password" id="password" class="form-control" required>
        </div>
        <button type="submit" class="btn btn-primary btn-block action-button mt-4">Login</button>
      </form>
      <div id="error-message" class="text-danger mt-3 text-center"></div>
    </div>
  </div>



  <div id="student-content" class="content-section container-fluid">
    <nav class="navbar navbar-expand-lg navbar-light bg-light shadow-sm mb-4">
      <a class="navbar-brand" href="#">Panel de Estudiantes</a>
      <div class="ml-auto">
        <button class="btn btn-outline-danger logout-button" onclick="handleLogout()">Cerrar sesión</button>
      </div>
    </nav>


    <div class="row">
      <div class="col-md-3 col-lg-2">
        <div class="nav flex-column nav-pills custom-nav-pills" id="v-pills-tab" role="tablist"
          aria-orientation="vertical">
          <a class="nav-link active" id="v-pills-subjects-tab" data-toggle="pill" href="#enrolled-subjects" role="tab"
            aria-controls="enrolled-subjects" aria-selected="true"
            onclick="switchTab('enrolled-subjects', this)">Materias</a>
          <a class="nav-link" id="v-pills-grades-tab" data-toggle="pill" href="#grades" role="tab"
            aria-controls="grades" aria-selected="false" onclick="switchTab('grades', this)">Calificaciones</a>
          <a class="nav-link" id="v-pills-kardex-tab" data-toggle="pill" href="#kardex" role="tab"
            aria-controls="kardex" aria-selected="false" onclick="switchTab('kardex', this)">Kardex</a>
          <a class="nav-link" id="v-pills-payments-tab" data-toggle="pill" href="#payments" role="tab"
            aria-controls="payments" aria-selected="false" onclick="switchTab('payments', this)">Pagos</a>
          <a class="nav-link" id="v-pills-attendance-tab" data-toggle="pill" href="#attendance" role="tab"
            aria-controls="attendance" aria-selected="false" onclick="switchTab('attendance', this)">Asistencias</a>
        </div>
      </div>
      <div class="col-md-9 col-lg-10">
        <div class="tab-content" id="v-pills-tabContent">
          <div class="tab-pane fade show active" id="enrolled-subjects" role="tabpanel"
            aria-labelledby="v-pills-subjects-tab">
            <h3 class="mb-3">Materias</h3>
            <div class="table-responsive">
              <table class="table table-hover table-striped">
                <thead class="thead-dark">
                  <tr>
                    <th>Nombre</th>
                    <th>Profesor</th>
                    <th>Horarios</th>
                    <th>Grupos</th>
                  </tr>
                </thead>
                <tbody id="subjects-table">
                </tbody>
              </table>
            </div>
          </div>

          <div class="tab-pane fade" id="grades" role="tabpanel" aria-labelledby="v-pills-grades-tab">
            <h3 class="mb-3">Calificaciones</h3>
            <div class="table-responsive">
              <table class="table table-hover table-striped">
                <thead class="thead-dark">
                  <tr>
                    <th>Nombre</th>
                    <th>Parcial 1</th>
                    <th>Parcial 2</th>
                    <th>Final</th>
                    <th>Promedio</th>
                  </tr>
                </thead>
                <tbody id="grades-table">
                </tbody>
              </table>
            </div>
          </div>

          <div class="tab-pane fade" id="kardex" role="tabpanel" aria-labelledby="v-pills-kardex-tab">
            <h3 class="mb-3">Historial académico</h3>
            <div class="table-responsive">
              <table class="table table-hover table-striped">
                <thead class="thead-dark">
                  <tr>
                    <th>Materia</th>
                    <th>Periodo</th>
                    <th>Calificación final</th>
                    <th>Estado</th>
                  </tr>
                </thead>
                <tbody id="kardex-table">
                </tbody>
              </table>
            </div>
          </div>

          <div class="tab-pane fade" id="payments" role="tabpanel" aria-labelledby="v-pills-payments-tab">
            <h3 class="mb-3">Estado de pagos</h3>
            <div class="table-responsive">
              <table class="table table-hover table-striped">
                <thead class="thead-dark">
                  <tr>
                    <th>Mes</th>
                    <th>Cantidad</th>
                    <th>Fecha de corte</th>
                    <th>Estado</th>
                    <th>Acción</th>
                  </tr>
                </thead>
                <tbody id="payments-table">
                </tbody>
              </table>
            </div>
          </div>

          <div class="tab-pane fade" id="attendance" role="tabpanel" aria-labelledby="v-pills-attendance-tab">
            <h3 class="mb-3">Registro de asistencia</h3>
            <div class="qr-section card p-4 shadow-sm">
              <div id="qr-reader" class="mb-3 text-center"></div>
              <p class="text-center">Ingresa código de asistencia:</p>
              <div class="form-group">
                <input type="text" id="attendance-code" class="form-control" placeholder="Ingresa código">
              </div>
              <button onclick="submitAttendance()" class="btn btn-primary action-button btn-block mt-3">Enviar</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div id="student-panel" class="content-section" style="display:none;">
    <h2>Gestión de Estudiantes</h2>
    <button class="btn btn-primary mb-3" onclick="showStudentForm('create')">Crear Nuevo Estudiante</button>

    <div id="student-form-section" class="card p-4 shadow-sm mb-4" style="display:none;">
      <h3><span id="student-form-title"></span> Estudiante</h3>
      <form id="student-form">
        <input type="hidden" id="student-matricula-edit">
        <div class="form-group">
          <label for="matricula">Matrícula:</label>
          <input type="text" class="form-control" id="matricula" required>
        </div>
        <div class="form-group">
          <label for="nombre">Nombre:</label>
          <input type="text" class="form-control" id="nombre" required>
        </div>
        <div class="form-group">
          <label for="carrera">Carrera:</label>
          <input type="text" class="form-control" id="carrera" required>
        </div>
        <div class="form-group">
          <label for="semestre">Semestre:</label>
          <input type="text" class="form-control" id="semestre" required>
        </div>
        <div class="form-group">
          <label for="user_name">Usuario:</label>
          <input type="text" class="form-control" id="user_name" required>
        </div>
        <div class="form-group">
          <label for="celular">Celular:</label>
          <input type="text" class="form-control" id="celular" required>
        </div>
        <div class="form-group">
          <label for="email">Email:</label>
          <input type="email" class="form-control" id="email" required>
        </div>
        <button type="submit" class="btn btn-success">Guardar Estudiante</button>
        <button type="button" class="btn btn-secondary" onclick="hideStudentForm()">Cancelar</button>
      </form>
    </div>

    <table id="students-table" class="table table-striped table-bordered" style="width:100%">
      <thead>
        <tr>
          <th>Matrícula</th>
          <th>Nombre</th>
          <th>Carrera</th>
          <th>Semestre</th>
          <th>Usuario</th>
          <th>Celular</th>
          <th>Email</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
      </tbody>
    </table>
  </div>

  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
    integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
    integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
    crossorigin="anonymous"></script>

  <div id="student-panel" class="content-section" style="display:none;">
    <h2>Gestión de Estudiantes</h2>
    <button class="btn btn-primary mb-3" onclick="showStudentForm('create')">Crear Nuevo Estudiante</button>

    <div id="student-form-section" class="card p-4 shadow-sm mb-4" style="display:none;">
      <h3><span id="student-form-title"></span> Estudiante</h3>
      <form id="student-form">
        <input type="hidden" id="student-matricula-edit">
        <div class="form-group">
          <label for="matricula">Matrícula:</label>
          <input type="text" class="form-control" id="matricula" required>
        </div>
        <div class="form-group">
          <label for="nombre">Nombre:</label>
          <input type="text" class="form-control" id="student-nombre" required>
        </div>
        <div class="form-group">
          <label for="carrera">Carrera:</label>
          <input type="text" class="form-control" id="carrera" required>
        </div>
        <div class="form-group">
          <label for="semestre">Semestre:</label>
          <input type="text" class="form-control" id="semestre" required>
        </div>
        <div class="form-group">
          <label for="user_name">Usuario:</label>
          <input type="text" class="form-control" id="student-user_name" required>
        </div>
        <div class="form-group">
          <label for="celular">Celular:</label>
          <input type="text" class="form-control" id="student-celular" required>
        </div>
        <div class="form-group">
          <label for="email">Email:</label>
          <input type="email" class="form-control" id="student-email" required>
        </div>
        <button type="submit" class="btn btn-success">Guardar Estudiante</button>
        <button type="button" class="btn btn-secondary" onclick="hideStudentForm()">Cancelar</button>
      </form>
    </div>

    <table id="students-table" class="table table-striped table-bordered" style="width:100%">
      <thead>
        <tr>
          <th>Matrícula</th>
          <th>Nombre</th>
          <th>Carrera</th>
          <th>Semestre</th>
          <th>Usuario</th>
          <th>Celular</th>
          <th>Email</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
      </tbody>
    </table>
  </div>

  <div id="professor-panel" class="content-section" style="display:none;">
    <h2>Gestión de Profesores</h2>
    <button class="btn btn-primary mb-3" onclick="showProfessorForm('create')">Crear Nuevo Profesor</button>

    <div id="professor-form-section" class="card p-4 shadow-sm mb-4" style="display:none;">
      <h3><span id="professor-form-title"></span> Profesor</h3>
      <form id="professor-form">
        <input type="hidden" id="professor-id-edit">
        <div class="form-group">
          <label for="id_profesor">ID Profesor:</label>
          <input type="text" class="form-control" id="id_profesor" required>
        </div>
        <div class="form-group">
          <label for="profesor_nombre">Nombre:</label>
          <input type="text" class="form-control" id="profesor_nombre" required>
        </div>
        <div class="form-group">
          <label for="profesor_celular">Celular:</label>
          <input type="text" class="form-control" id="profesor_celular" required>
        </div>
        <div class="form-group">
          <label for="profesor_email">Email:</label>
          <input type="email" class="form-control" id="profesor_email" required>
        </div>
        <div class="form-group">
          <label for="profesor_fecha_ingreso">Fecha de Ingreso:</label>
          <input type="date" class="form-control" id="profesor_fecha_ingreso" required>
        </div>
        <button type="submit" class="btn btn-success">Guardar Profesor</button>
        <button type="button" class="btn btn-secondary" onclick="hideProfessorForm()">Cancelar</button>
      </form>
    </div>

    <table id="professors-table" class="table table-striped table-bordered" style="width:100%">
      <thead>
        <tr>
          <th>ID Profesor</th>
          <th>Nombre</th>
          <th>Celular</th>
          <th>Email</th>
          <th>Fecha de Ingreso</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
      </tbody>
    </table>
  </div>

  <div id="subject-panel" class="content-section" style="display:none;">
    <h2>Gestión de Materias</h2>
    <button class="btn btn-primary mb-3" onclick="showSubjectForm('create')">Crear Nueva Materia</button>

    <div id="subject-form-section" class="card p-4 shadow-sm mb-4" style="display:none;">
      <h3><span id="subject-form-title"></span> Materia</h3>
      <form id="subject-form">
        <input type="hidden" id="subject-id-edit">
        <div class="form-group">
          <label for="id_materia">ID Materia:</label>
          <input type="text" class="form-control" id="id_materia" required>
        </div>
        <div class="form-group">
          <label for="materia_nombre">Nombre Materia:</label>
          <input type="text" class="form-control" id="materia_nombre" required>
        </div>
        <div class="form-group">
          <label for="sem_cursante">Semestre Cursante:</label>
          <input type="text" class="form-control" id="sem_cursante" required>
        </div>
        <button type="submit" class="btn btn-success">Guardar Materia</button>
        <button type="button" class="btn btn-secondary" onclick="hideSubjectForm()">Cancelar</button>
      </form>
    </div>

    <table id="subjects-table" class="table table-striped table-bordered" style="width:100%">
      <thead>
        <tr>
          <th>ID Materia</th>
          <th>Nombre Materia</th>
          <th>Semestre Cursante</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
      </tbody>
    </table>
  </div>

  <div id="grade-panel" class="content-section" style="display:none;">
    <h2>Gestión de Calificaciones</h2>
    <button class="btn btn-primary mb-3" onclick="showGradeForm('create')">Crear Nueva Calificación</button>

    <div id="grade-form-section" class="card p-4 shadow-sm mb-4" style="display:none;">
      <h3><span id="grade-form-title"></span> Calificación</h3>
      <form id="grade-form">
        <input type="hidden" id="grade-id_materia-edit">
        <input type="hidden" id="grade-matricula-edit">
        <div class="form-group">
          <label for="grade_id_materia">ID Materia:</label>
          <input type="text" class="form-control" id="grade_id_materia" required>
        </div>
        <div class="form-group">
          <label for="grade_matricula">Matrícula Alumno:</label>
          <input type="text" class="form-control" id="grade_matricula" required>
        </div>
        <div class="form-group">
          <label for="calif_p1">Calificación P1:</label>
          <input type="text" class="form-control" id="calif_p1">
        </div>
        <div class="form-group">
          <label for="calif_p2">Calificación P2:</label>
          <input type="text" class="form-control" id="calif_p2">
        </div>
        <div class="form-group">
          <label for="calif_final">Calificación Final:</label>
          <input type="text" class="form-control" id="calif_final">
        </div>
        <div class="form-group">
          <label for="ciclo_cursando">Ciclo Cursando:</label>
          <input type="text" class="form-control" id="ciclo_cursando" required>
        </div>
        <button type="submit" class="btn btn-success">Guardar Calificación</button>
        <button type="button" class="btn btn-secondary" onclick="hideGradeForm()">Cancelar</button>
      </form>
    </div>

    <table id="grades-table" class="table table-striped table-bordered" style="width:100%">
      <thead>
        <tr>
          <th>ID Materia</th>
          <th>Matrícula</th>
          <th>Calificación P1</th>
          <th>Calificación P2</th>
          <th>Calificación Final</th>
          <th>Ciclo Cursando</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
      </tbody>
    </table>
  </div>
  <div id="professor-content" class="content-section container-fluid">
    <nav class="navbar navbar-expand-lg navbar-light bg-light shadow-sm mb-4">
      <a class="navbar-brand" href="#">Panel de Profesor</a>
      <div class="ml-auto">
        <button class="btn btn-outline-danger logout-button" onclick="handleLogout()">Cerrar sesión</button>
      </div>
    </nav>

    <div class="row">
      <div class="col-md-3 col-lg-2">
        <div class="nav flex-column nav-pills custom-nav-pills" id="v-pills-tab-prof" role="tablist"
          aria-orientation="vertical">
          <a class="nav-link active" id="v-pills-schedule-tab" data-toggle="pill" href="#teaching-schedule" role="tab"
            aria-controls="teaching-schedule" aria-selected="true"
            onclick="switchTab('teaching-schedule', this)">Horario de clases</a>
          <a class="nav-link" id="v-pills-qr-tab" data-toggle="pill" href="#attendance-qr" role="tab"
            aria-controls="attendance-qr" aria-selected="false" onclick="switchTab('attendance-qr', this)">QR de
            asistencia</a>
          <a class="nav-link" id="v-pills-grade-entry-tab" data-toggle="pill" href="#profesor_grade_entry" role="tab"
            aria-controls="profesor_grade_entry" aria-selected="false"
            onclick="switchTab('profesor_grade_entry', this)">Ingreso de Calificaciones</a>
        </div>
      </div>
      <div class="col-md-9 col-lg-10">
        <div class="tab-content" id="v-pills-tabContent-prof">
          <div class="tab-pane fade show active" id="teaching-schedule" role="tabpanel"
            aria-labelledby="v-pills-schedule-tab">
            <h3 class="mb-3">Horario de clases</h3>
            <div class="table-responsive">
              <table class="table table-hover table-striped">
                <thead class="thead-dark">
                  <tr>
                    <th>Materia</th>
                    <th>Grupo</th>
                    <th>Horario</th>
                  </tr>
                </thead>
                <tbody id="schedule-table">
                </tbody>
              </table>
            </div>
          </div>

          <div class="tab-pane fade" id="attendance-qr" role="tabpanel" aria-labelledby="v-pills-qr-tab">
            <h3 class="mb-3">Generar QR de asistencia</h3>
            <div class="card p-4 shadow-sm">
              <div class="form-group">
                <label for="qr_subject_select">Elegir materia</label>
                <select id="qr_subject_select" class="form-control">
                  <option value="">Seleccione una materia</option>
                </select>
              </div>
              <button onclick="QR_CODE_GEN()" class="btn btn-primary action-button mt-3">Generar QR</button>
              <div id="qr-display" class="mt-4 text-center"></div>
            </div>
          </div>

          <div class="tab-pane fade" id="profesor_grade_entry" role="tabpanel"
            aria-labelledby="v-pills-grade-entry-tab">
            <h3 class="mb-3">Ingreso de calificaciones</h3>
            <div class="form-group">
              <label for="professor_grade_subject_select">Elija materia</label>
              <select id="professor_grade_subject_select" class="form-control"></select>
            </div>
            <div class="table-responsive mt-4">
              <table class="table table-hover table-striped">
                <thead class="thead-dark">
                  <tr>
                    <th>Estudiante</th>
                    <th>Parcial 1</th>
                    <th>Parcial 2</th>
                    <th>Final</th>
                    <th>Acción</th>
                  </tr>
                </thead>
                <tbody id="profesor_grade_entry_table">
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="admin-staff-content" class="content-section container-fluid">
    <nav class="navbar navbar-expand-lg navbar-light bg-light shadow-sm mb-4">
      <a class="navbar-brand" href="#">Panel de Administrativos</a>
      <div class="ml-auto">
        <button class="btn btn-outline-danger logout-button" onclick="handleLogout()">Cerrar sesión</button>
      </div>
    </nav>
    <div class="row">
      <div class="col-md-3 col-lg-2">
        <div class="nav flex-column nav-pills custom-nav-pills" id="v-pills-tab-admin" role="tablist"
          aria-orientation="vertical">
          <a class="nav-link active" id="v-pills-student-mgmt-tab" data-toggle="pill" href="#student-management"
            role="tab" aria-controls="student-management" aria-selected="true"
            onclick="switchTab('student-management', this)">Estudiantes</a>
          <a class="nav-link" id="v-pills-professor-mgmt-tab" data-toggle="pill" href="#professor-management" role="tab"
            aria-controls="professor-management" aria-selected="false"
            onclick="switchTab('professor-management', this)">Profesores</a>
          <a class="nav-link" id="v-pills-subject-mgmt-tab" data-toggle="pill" href="#subject-management" role="tab"
            aria-controls="subject-management" aria-selected="false"
            onclick="switchTab('subject-management', this)">Materias</a>
          <a class="nav-link" id="v-pills-reports-tab" data-toggle="pill" href="#reports" role="tab"
            aria-controls="reports" aria-selected="false" onclick="switchTab('reports', this)">Reportes</a>
          <a class="nav-link" id="v-pills-payments-admin-tab" data-toggle="pill" href="#payments-admin" role="tab"
            aria-controls="payments-admin" aria-selected="false" onclick="switchTab('payments-admin', this)">Gestión de
            Pagos</a>
          <a class="nav-link" id="v-pills-attendance-admin-tab" data-toggle="pill" href="#attendance-admin" role="tab"
            aria-controls="attendance-admin" aria-selected="false" onclick="switchTab('attendance-admin', this)">Gestión
            de Asistencia</a>
        </div>
      </div>
      <div class="col-md-9 col-lg-10">
        <div class="tab-content" id="v-pills-tabContent-admin">
          <div class="tab-pane fade show active" id="student-management" role="tabpanel"
            aria-labelledby="v-pills-student-mgmt-tab">
            <h3 class="mb-3">Gestión de Estudiantes</h3>
            <button class="btn btn-success action-button mb-3" data-toggle="modal"
              data-target="#addStudentModal">Agregar Estudiante</button>
            <div class="table-responsive">
              <table class="table table-hover table-striped">
                <thead class="thead-dark">
                  <tr>
                    <th>Matrícula</th>
                    <th>Nombre</th>
                    <th>Carrera</th>
                    <th>Semestre</th>
                    <th>Celular</th>
                    <th>Email</th>
                    <th>Acciones</th>
                  </tr>
                </thead>
                <tbody id="admin-student-table">
                </tbody>
              </table>
            </div>
          </div>

          <div class="tab-pane fade" id="professor-management" role="tabpanel"
            aria-labelledby="v-pills-professor-mgmt-tab">
            <h3 class="mb-3">Gestión de Profesores</h3>
            <button class="btn btn-success action-button mb-3" data-toggle="modal"
              data-target="#addProfessorModal">Agregar Profesor</button>
            <div class="table-responsive">
              <table class="table table-hover table-striped">
                <thead class="thead-dark">
                  <tr>
                    <th>ID Profesor</th>
                    <th>Nombre</th>
                    <th>Celular</th>
                    <th>Email</th>
                    <th>Acciones</th>
                  </tr>
                </thead>
                <tbody id="admin-professor-table">
                  <tr>
                    <td>P001</td>
                    <td>Maria Garcia</td>
                    <td>5587654321</td>
                    <td>maria.garcia@example.com</td>
                    <td>
                      <button class="btn btn-sm btn-info mr-2">Editar</button>
                      <button class="btn btn-sm btn-danger">Eliminar</button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          <div class="tab-pane fade" id="subject-management" role="tabpanel" aria-labelledby="v-pills-subject-mgmt-tab">
            <h3 class="mb-3">Gestión de Materias</h3>
            <button class="btn btn-success action-button mb-3" data-toggle="modal"
              data-target="#addSubjectModal">Agregar Materia</button>
            <div class="table-responsive">
              <table class="table table-hover table-striped">
                <thead class="thead-dark">
                  <tr>
                    <th>ID Materia</th>
                    <th>Nombre</th>
                    <th>Semestre Cursante</th>
                    <th>Acciones</th>
                  </tr>
                </thead>
                <tbody id="admin-subject-table">
                  <tr>
                    <td>MAT101</td>
                    <td>Cálculo Diferencial</td>
                    <td>1</td>
                    <td>
                      <button class="btn btn-sm btn-info mr-2">Editar</button>
                      <button class="btn btn-sm btn-danger">Eliminar</button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <h4 class="mt-4">Asignar Materias a Profesores</h4>
            <div class="card p-3 shadow-sm mb-3">
              <div class="form-group">
                <label for="assign_prof_subject">Profesor</label>
                <select id="assign_prof_subject" class="form-control"></select>
              </div>
              <div class="form-group">
                <label for="assign_subject_group">Materia y Grupo</label>
                <select id="assign_subject_group" class="form-control"></select>
              </div>
              <button class="btn btn-primary action-button">Asignar</button>
            </div>
            <h4 class="mt-4">Asignar Materias a Estudiantes (Grupos)</h4>
            <div class="card p-3 shadow-sm">
              <div class="form-group">
                <label for="assign_student_subject">Estudiante</label>
                <select id="assign_student_subject" class="form-control"></select>
              </div>
              <div class="form-group">
                <label for="assign_student_group">Materia y Grupo</label>
                <select id="assign_student_group" class="form-control"></select>
              </div>
              <button class="btn btn-primary action-button">Asignar</button>
            </div>
          </div>
          <div class="tab-pane fade" id="reports" role="tabpanel" aria-labelledby="v-pills-reports-tab">
            <h3 class="mb-3">Reportes</h3>
            <p>Generación de reportes académicos y administrativos.</p>
            <button class="btn btn-secondary action-button mr-2">Reporte de Calificaciones</button>
            <button class="btn btn-secondary action-button">Reporte de Asistencias</button>
          </div>
          <div class="tab-pane fade" id="payments-admin" role="tabpanel" aria-labelledby="v-pills-payments-admin-tab">
            <h3 class="mb-3">Gestión de Pagos</h3>
            <button class="btn btn-success action-button mb-3" data-toggle="modal"
              data-target="#addPaymentModal">Registrar Pago</button>
            <div class="table-responsive">
              <table class="table table-hover table-striped">
                <thead class="thead-dark">
                  <tr>
                    <th>Matrícula</th>
                    <th>Ciclo</th>
                    <th>Fecha Vencimiento</th>
                    <th>Fecha Pago</th>
                    <th>Monto</th>
                    <th>Estado</th>
                    <th>Acciones</th>
                  </tr>
                </thead>
                <tbody id="admin-payments-table">
                  <tr>
                    <td>A001</td>
                    <td>2025-1</td>
                    <td>2025-01-31</td>
                    <td>2025-01-28</td>
                    <td>$1500.00</td>
                    <td>Pagado</td>
                    <td>
                      <button class="btn btn-sm btn-info mr-2">Detalles</button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          <div class="tab-pane fade" id="attendance-admin" role="tabpanel" aria-labelledby="v-pills-attendance-admin-tab">
            <h3 class="mb-3">Gestión de Asistencia</h3>
            <p>Visualización y gestión de registros de asistencia por materia/grupo.</p>
            <div class="form-group">
              <label for="attendance_subject_group">Filtrar por Materia y Grupo</label>
              <select id="attendance_subject_group" class="form-control"></select>
            </div>
            <div class="table-responsive mt-3">
              <table class="table table-hover table-striped">
                <thead class="thead-dark">
                  <tr>
                    <th>Fecha/Hora</th>
                    <th>Matrícula</th>
                    <th>Materia</th>
                    <th>Código</th>
                    <th>Ciclo</th>
                  </tr>
                </thead>
                <tbody id="admin-attendance-table">
                  <tr>
                    <td>2025-06-10 09:00:00</td>
                    <td>A001</td>
                    <td>MAT101</td>
                    <td>ABC123</td>
                    <td>2025-1</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="super-admin-content" class="content-section container-fluid">
    <nav class="navbar navbar-expand-lg navbar-light bg-light shadow-sm mb-4">
      <a class="navbar-brand" href="#">Administración del Sistema</a>
      <div class="ml-auto">
        <button class="btn btn-outline-danger logout-button" onclick="handleLogout()">Cerrar sesión</button>
      </div>
    </nav>
    <div class="row">
      <div class="col-md-3 col-lg-2">
        <div class="nav flex-column nav-pills custom-nav-pills" id="v-pills-tab-superadmin" role="tablist"
          aria-orientation="vertical">
          <a class="nav-link active" id="v-pills-user-mgmt-tab" data-toggle="pill" href="#user-management" role="tab"
            aria-controls="user-management" aria-selected="true" onclick="switchTab('user-management', this)">Usuarios</a>
          <a class="nav-link" id="v-pills-system-config-tab" data-toggle="pill" href="#system-config" role="tab"
            aria-controls="system-config" aria-selected="false" onclick="switchTab('system-config', this)">Configuraciones</a>
          <a class="nav-link" id="v-pills-system-logs-tab" data-toggle="pill" href="#system-logs" role="tab"
            aria-controls="system-logs" aria-selected="false" onclick="switchTab('system-logs', this)">Registros</a>
        </div>
      </div>
      <div class="col-md-9 col-lg-10">
        <div class="tab-content" id="v-pills-tabContent-superadmin">
          <div class="tab-pane fade show active" id="user-management" role="tabpanel"
            aria-labelledby="v-pills-user-mgmt-tab">
            <h3 class="mb-3">Gestión de Usuarios</h3>
            <button class="btn btn-success action-button mb-3" data-toggle="modal"
              data-target="#addUserModal">Agregar Usuario</button>
            <div class="table-responsive">
              <table class="table table-hover table-striped">
                <thead class="thead-dark">
                  <tr>
                    <th>ID Usuario</th>
                    <th>Nombre de Usuario</th>
                    <th>Rol</th>
                    <th>Acciones</th>
                  </tr>
                </thead>
                <tbody id="superadmin-user-table">
                  <tr>
                    <td>U001</td>
                    <td>admin_user</td>
                    <td>Admin</td>
                    <td>
                      <button class="btn btn-sm btn-info mr-2">Editar</button>
                      <button class="btn btn-sm btn-danger">Eliminar</button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          <div class="tab-pane fade" id="system-config" role="tabpanel" aria-labelledby="v-pills-system-config-tab">
            <h3 class="mb-3">Configuraciones del Sistema</h3>
            <p>Formularios para configurar parámetros globales del sistema, como ciclos escolares, notificaciones, etc. </p>
            <form>
              <div class="form-group">
                <label for="current_cycle">Ciclo Actual</label>
                <input type="text" id="current_cycle" class="form-control" value="2025-1">
              </div>
              <button class="btn btn-primary action-button">Guardar Configuración</button>
            </form>
          </div>
          <div class="tab-pane fade" id="system-logs" role="tabpanel" aria-labelledby="v-pills-system-logs-tab">
            <h3 class="mb-3">Registros del Sistema</h3>
            <p>Visualización de logs de actividad y errores del sistema.</p>
            <div class="table-responsive">
              <table class="table table-hover table-striped">
                <thead class="thead-dark">
                  <tr>
                    <th>Fecha/Hora</th>
                    <th>Tipo</th>
                    <th>Mensaje</th>
                  </tr>
                </thead>
                <tbody id="superadmin-logs-table">
                  <tr>
                    <td>2025-06-10 10:30:00</td>
                    <td>INFO</td>
                    <td>User 'admin_user' logged in.</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
    integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
    integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
    integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
    crossorigin="anonymous"></script>
  <script src="https://cdn.datatables.net/2.2.2/js/dataTables.min.js"></script>
  <script src="https://cdn.rawgit.com/davidshimjs/qrcodejs/gh-pages/qrcode.min.js"></script>
  <script>
    // Roles
    const ROLES = { STUDENT: 1, PROFESSOR: 2, ADMIN_STAFF: 3, SUPER_ADMIN: 99 };

    // display por roles
    function showUserRole(role) {
      document.querySelectorAll('.content-section').forEach(section => { section.style.display = 'none'; });

      switch (parseInt(role)) {
        case ROLES.SUPER_ADMIN: document.getElementById('super-admin-content').style.display = 'block'; break;
        case ROLES.PROFESSOR: document.getElementById('professor-content').style.display = 'block'; break;
        case ROLES.STUDENT: document.getElementById('student-content').style.display = 'block'; break;
        case ROLES.ADMIN_STAFF: document.getElementById('admin-staff-content').style.display = 'block'; break;
        default: document.getElementById('login-content').style.display = 'block';
      }
    }

    // Funciones para manejar el token y el rol en localStorage
    function setAuthToken(token) {
      localStorage.setItem('authToken', token);
    }

    function getAuthToken() {
      return localStorage.getItem('authToken');
    }

    function clearAuthToken() {
      localStorage.removeItem('authToken');
    }

    function setUserRole(role) {
      localStorage.setItem('userRole', role);
    }

    function getUserRole() {
      return localStorage.getItem('userRole');
    }

    function clearUserRole() {
      localStorage.removeItem('userRole');
    }


    // Handle login form submission
    async function handleLogin(event) {
      event.preventDefault(); // Evita el envío por defecto del formulario

      const username = document.getElementById('username').value;
      const password = document.getElementById('password').value;
      const errorMessage = document.getElementById('error-message');
      errorMessage.textContent = ''; // Limpia errores previos

      try {
        // --- INICIO: LÓGICA DE AUTENTICACIÓN REAL ---
        // Aquí debes reemplazar esta simulación con tu llamada a la API de autenticación real
        // Ejemplo de fetch a tu backend (asegúrate de que tu backend tenga el endpoint /login)
        const response = await fetch(`http://${backendIP}:3000/login`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ username, password })
        });

        if (!response.ok) {
          const errorData = await response.json();
          throw new Error(errorData.message || 'Error de autenticación');
        }

        const data = await response.json();
        setAuthToken(data.token); // Guarda el token recibido del backend
        setUserRole(data.role); // Guarda el rol del usuario recibido del backend

        // --- FIN: LÓGICA DE AUTENTICACIÓN REAL ---

        showUserRole(data.role); // Muestra el contenido basado en el rol

        // Opcionalmente, resetea el formulario de login
        document.getElementById('login-form').reset();

        // Inicializa el contenido de la primera pestaña para el rol específico después del login
        // Aquí deberías llamar a las funciones que cargan datos (loadStudents(), loadSubjectsProf(), etc.)
        // para la pestaña predeterminada de cada rol.
        if (parseInt(data.role) === ROLES.ADMIN_STAFF) {
          const adminTab = document.getElementById('v-pills-student-mgmt-tab');
          if(adminTab) {
              switchTab('student-management', adminTab);
          }
        } else if (parseInt(data.role) === ROLES.PROFESSOR) {
          const profTab = document.getElementById('v-pills-schedule-tab');
          if(profTab) {
              switchTab('teaching-schedule', profTab);
          }
        } else if (parseInt(data.role) === ROLES.STUDENT) {
          const studentTab = document.getElementById('v-pills-subjects-tab');
          if(studentTab) {
              switchTab('enrolled-subjects', studentTab);
          }
        } else if (parseInt(data.role) === ROLES.SUPER_ADMIN) {
          const superAdminTab = document.getElementById('v-pills-user-mgmt-tab');
          if(superAdminTab) {
              switchTab('user-management', superAdminTab);
          }
        }

      } catch (error) {
        console.error("Fallo el inicio de sesion:", error);
        errorMessage.textContent = error.message || 'Usuario o contraseña incorrectos.';
      }
    }

    // Handle logout
    function handleLogout() {
      clearAuthToken();
      clearUserRole();
      showUserRole(null); // Muestra la pantalla de login
      // Opcionalmente, recarga la página para asegurar que todos los datos de la sesión anterior se limpien
      location.reload();
    }

    // Verifica si hay un token y un rol almacenados al cargar la página
    document.addEventListener('DOMContentLoaded', () => {
      const storedRole = getUserRole();
      if (storedRole && getAuthToken()) {
        showUserRole(storedRole);
        // Activa la primera pestaña por defecto para el rol si ya está logeado
        if (parseInt(storedRole) === ROLES.ADMIN_STAFF) {
            const adminTab = document.getElementById('v-pills-student-mgmt-tab');
            if(adminTab) {
                switchTab('student-management', adminTab);
            }
        } else if (parseInt(storedRole) === ROLES.PROFESSOR) {
            const profTab = document.getElementById('v-pills-schedule-tab');
            if(profTab) {
                switchTab('teaching-schedule', profTab);
            }
        } else if (parseInt(storedRole) === ROLES.STUDENT) {
            const studentTab = document.getElementById('v-pills-subjects-tab');
            if(studentTab) {
                switchTab('enrolled-subjects', studentTab);
            }
        } else if (parseInt(storedRole) === ROLES.SUPER_ADMIN) {
            const superAdminTab = document.getElementById('v-pills-user-mgmt-tab');
            if(superAdminTab) {
                switchTab('user-management', superAdminTab);
            }
        }
      } else {
        showUserRole(null); // No hay token o rol, muestra la pantalla de login
      }

      // Adjunta el event listener al formulario de login
      const loginForm = document.getElementById('login-form');
      if (loginForm) {
        loginForm.addEventListener('submit', handleLogin);
      }
    });

    //Estilos tabla dinámica
    const dataTableStyle = {
      pageLength: 5,
      lengthMenu: [5, 10, 20],
      destroy: true,
      language: {
        lengthMenu: "Mostrar _MENU_ registros por pagina",
        zeroRecords: "No se encontraron registros",
        info: "Mostrando pagina _PAGE_ de _PAGES_",
        infoEmpty: "No hay registros disponibles",
        infoFiltered: "(filtrado de _MAX_ registros totales)",
        search: "Buscar:",
        paginate: {
          first: "Primero",
          last: "Ultimo",
          next: "Siguiente",
          previous: "Anterior"
        }
      }
    };
    //////////////////////////////
    function getBackendIP() {
      let backendIP = localStorage.getItem('backendIP');
      // Set a default IP if not found or if you want to hardcode for development
      if (!backendIP) {
          backendIP = "192.168.100.20"; // Example: Your backend IP
          localStorage.setItem('backendIP', backendIP);
      }
      return backendIP;
    }
    var backendIP = getBackendIP();

    // cambia paginas
    function switchTab(tabId, element) {
      // Elimina la clase 'active' de todas las pestañas de navegación y contenido de pestañas
      document.querySelectorAll('.nav-link').forEach(tab => { tab.classList.remove('active'); });
      document.querySelectorAll('.tab-pane').forEach(content => { content.classList.remove('show', 'active'); });

      // Establece la clase 'active' en la pestaña actual y su contenido
      if(element) { // Asegura que 'element' existe antes de intentar acceder a sus propiedades
        element.classList.add('active');
      }
      document.getElementById(tabId).classList.add('show', 'active'); // Bootstrap necesita 'show' y 'active' para las transiciones de pestañas

      // Carga de datos específicos para cada pestaña
      try {
        switch (tabId) {
          case 'enrolled-subjects': /* loadSubjects(); */ console.log('Cargando materias del estudiante...'); break;
          case 'grades': /* loadGrades(); */ console.log('Cargando calificaciones del estudiante...'); break;
          case 'kardex': /* loadKardez(); */ console.log('Cargando kardex del estudiante...'); break;
          case 'payments': /* loadPagos(); */ console.log('Cargando pagos del estudiante...'); break;
          case 'attendance': /* initializeAttendance(); */ console.log('Inicializando asistencia del estudiante...'); break;
          case 'teaching-schedule': /* loadSubjectsProf(); */ console.log('Cargando horario del profesor...'); break;
          case 'attendance-qr': /* QR_CODE_GEN(); */ console.log('Generando codigo QR...'); break;
          case 'profesor_grade_entry': /* fetchSubjects(); */ console.log('Cargando ingreso de calificaciones del profesor...'); break;
          case 'student-management': /* loadStudents(); */ console.log('Cargando gestión de estudiantes (Admin)...'); break;
          case 'professor-management': console.log('Cargando gestión de profesores (Admin)...'); break;
          case 'subject-management': console.log('Cargando gestión de materias (Admin)...'); break;
          case 'reports': console.log('Cargando reportes (Admin)...'); break;
          case 'payments-admin': console.log('Cargando gestión de pagos (Admin)...'); break;
          case 'attendance-admin': console.log('Cargando gestión de asistencia (Admin)...'); break;
          case 'user-management': console.log('Cargando gestión de usuarios (Super Admin)...'); break;
          case 'system-config': console.log('Cargando configuración del sistema (Super Admin)...'); break;
          case 'system-logs': console.log('Cargando registros del sistema (Super Admin)...'); break;
          default: console.log('Pestaña desconocida:', tabId);
        }
      } catch (error) {
        console.error("Error al cambiar de pestaña:", error);
      }
    }
  </script>
</body>

</html>